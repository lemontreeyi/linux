(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{191:function(t,e,i){"use strict";i.d(e,"e",(function(){return c})),i.d(e,"a",(function(){return l})),i.d(e,"c",(function(){return d})),i.d(e,"b",(function(){return p})),i.d(e,"g",(function(){return u})),i.d(e,"j",(function(){return g})),i.d(e,"f",(function(){return m})),i.d(e,"i",(function(){return y})),i.d(e,"d",(function(){return b})),i.d(e,"h",(function(){return f}));i(13),i(16),i(52);var o=i(104),s=i.n(o),n=i(2),a=i(0),r=i(23);const c={name:Object(n.i18n)("search"),uuid:"dd3af9cc97ad7de8984baaf59514bb52",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/mychromesearch.png",desc:"",types:[{name:Object(n.i18n)("html"),url:"https://www.google.com/search?q="},{name:Object(n.i18n)("photos"),url:"https://www.google.com/search?tbm=isch&q="},{name:Object(n.i18n)("news"),url:"https://www.google.com/search?tbm=nws&q="},{name:Object(n.i18n)("videos"),url:"https://www.google.com/search?tbm=vid&q="},{name:Object(n.i18n)("map"),url:"https://www.google.com/maps/preview?q="}]},l={name:Object(n.i18n)("baidu"),uuid:"0c47016a8cd2d631bc618d4f3a741335",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/baidu.png",desc:Object(n.i18n)("most_used_in_chinese"),types:[{name:Object(n.i18n)("html"),url:"https://www.baidu.com/s?tn=02003390_hao_pg&ie=utf-8&wd="},{name:Object(n.i18n)("photos"),url:"https://image.baidu.com/search/index?isource=infinity&iname=baidu&tn=baiduimage&word="},{name:Object(n.i18n)("news"),url:"https://news.baidu.com/ns?isource=infinity&iname=baidu&tn=news&ie=utf-8&word="},{name:Object(n.i18n)("videos"),url:"https://video.baidu.com/v?isource=infinity&iname=baidu&ie=utf-8&word="},{name:Object(n.i18n)("map"),url:"http://map.baidu.com/?isource=infinity&iname=baidu&newmap=1&ie=utf-8&s=s%26wd%3D"}]},d={name:Object(n.i18n)("google"),uuid:"a22dcc25c75de3f58cb518e32c576865",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/google.png",desc:Object(n.i18n)("google_desc"),types:[{name:Object(n.i18n)("html"),url:"https://www.google.com/search?q="},{name:Object(n.i18n)("photos"),url:"https://www.google.com/search?isource=infinity&iname=google&tbm=isch&q="},{name:Object(n.i18n)("news"),url:"https://www.google.com/search?isource=infinity&iname=google&tbm=nws&q="},{name:Object(n.i18n)("videos"),url:"https://www.google.com/search?isource=infinity&iname=google&tbm=vid&q="},{name:Object(n.i18n)("map"),url:"https://www.google.com/maps/preview?isource=infinity&iname=google&q="}]},p={name:Object(n.i18n)("bing"),uuid:"5a6afaa65c95a841f6149c4e1591a637",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/bing_new.png",desc:Object(n.i18n)("bing_desc"),types:[{name:Object(n.i18n)("html"),url:"https://cn.bing.com/search?isource=infinity&iname=bing&itype=web&q="},{name:Object(n.i18n)("photos"),url:"https://cn.bing.com/images/search?isource=infinity&iname=bing&q="},{name:Object(n.i18n)("news"),url:"https://global.bing.com/news/search?isource=infinity&iname=bing&q="},{name:Object(n.i18n)("videos"),url:"https://cn.bing.com/videos/search?isource=infinity&iname=bing&q="},{name:Object(n.i18n)("map"),url:"https://www.bing.com/ditu/?isource=infinity&iname=bing&q="}]},u=[l,d,p,{name:Object(n.i18n)("yahoo"),uuid:"C26068F55492EF9E93E05E34A3B31139",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/yahoo.png",desc:Object(n.i18n)("yahoo_desc"),types:[{name:Object(n.i18n)("html"),url:"https://search.yahoo.com/search?isource=infinity&iname=yahoo&itype=web&p="},{name:Object(n.i18n)("photos"),url:"https://images.search.yahoo.com/search?isource=infinity&iname=yahoo&p="},{name:Object(n.i18n)("news"),url:"https://news.search.yahoo.com/search?isource=infinity&iname=yahoo&p="},{name:Object(n.i18n)("videos"),url:"https://video.search.yahoo.com/search/video?isource=infinity&iname=yahoo&p="}]},{name:Object(n.i18n)("yandex"),uuid:"f33155f8c51a36fb76dad667dec7e44f",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/yandex.png",desc:Object(n.i18n)("yandex_desc"),types:[{name:Object(n.i18n)("html"),url:"https://yandex.com/search/?isource=infinity&itype=web&iname=yandex&text="},{name:Object(n.i18n)("photos"),url:"https://yandex.com/images/search?isource=infinity&iname=yandex&text="},{name:Object(n.i18n)("news"),url:"https://news.yandex.com/yandsearch?isource=infinity&iname=yandex&text="},{name:Object(n.i18n)("videos"),url:"https://yandex.com/video/search?isource=infinity&iname=yandex&text="}]},{name:Object(n.i18n)("duckduckgo"),uuid:"569CD6FB4F6502B918DB8B30EC235384",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/duckduckgo.png",desc:Object(n.i18n)("duckduckgo_desc"),types:[{name:Object(n.i18n)("html"),url:"https://duckduckgo.com/?isource=infinity&iname=duckduckgo&itype=web&q="},{name:Object(n.i18n)("photos"),url:"https://duckduckgo.com/?isource=infinity&iname=duckduckgo&t=h_&dbexp=a&iax=1&ia=images&q="},{name:Object(n.i18n)("news"),url:"https://duckduckgo.com/?isource=infinity&iname=duckduckgo&t=h_&dbexp=a&ia=news&q="},{name:Object(n.i18n)("videos"),url:"https://duckduckgo.com/?isource=infinity&iname=duckduckgo&t=h_&iax=1&ia=videos&q="}]},{name:Object(n.i18n)("n_360"),uuid:"70adaba7374f6089aca0374dea85df00",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/360.png",desc:Object(n.i18n)("360_desc"),types:[{name:Object(n.i18n)("html"),url:"https://www.so.com/s?src=lm&ls=sm2054017&lm_extend=ctype:4&q="},{name:Object(n.i18n)("photos"),url:"https://image.so.com/i?isource=infinity&iname=360&src=infinitynewtab&q="},{name:Object(n.i18n)("news"),url:"http://news.so.com/ns?isource=infinity&iname=360&src=infinitynewtab&q="},{name:Object(n.i18n)("videos"),url:"http://video.so.com/v?isource=infinity&iname=360&src=infinitynewtab&q="}]},{name:Object(n.i18n)("sougou"),uuid:"a3e908082e31a92396970f8b58583863",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/sougou.png",desc:Object(n.i18n)("sougou_desc"),types:[{name:Object(n.i18n)("html"),url:"https://www.sogou.com/sogou?isource=infinity&iname=sogou&itype=web&pid=sogou-site-7985672db979303a&query="},{name:Object(n.i18n)("photos"),url:"https://pic.sogou.com/pics?isource=infinity&iname=sogou&ie=utf8&query="},{name:Object(n.i18n)("news"),url:"http://news.sogou.com/news?isource=infinity&iname=sogou&ie=utf8&query="},{name:Object(n.i18n)("videos"),url:"http://v.sogou.com/v?isource=infinity&iname=sogou&ie=utf8&query="},{name:Object(n.i18n)("wechat"),url:"http://weixin.sogou.com/weixin?isource=infinity&iname=sogou&type=2&ie=utf8&query="}]},{name:Object(n.i18n)("yarndex_ru"),uuid:"ff1ca8c4e6661d52440b7f2e15cb6a13",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/russia-yandex.png",desc:Object(n.i18n)("yandex_desc"),types:[{name:Object(n.i18n)("html"),url:"https://yandex.ru/search/?text="},{name:Object(n.i18n)("photos"),url:"https://yandex.ru/images/search?text="},{name:Object(n.i18n)("news"),url:"https://news.yandex.ru/yandsearch?text="},{name:Object(n.i18n)("videos"),url:"https://yandex.ru/video/search?text="}]}],h={"zh-CN":[{name:Object(n.i18n)("tian_mao"),uuid:"be0ab26cf4dc6239c98791f7b18b633a",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/2f301c86bb2d0efeec3d49930147157f.png",type:"web",target:"https://s.click.taobao.com/t?e=m%3D2%26s%3DV5ucSP%2F1kT4cQipKwQzePCperVdZeJviK7Vc7tFgwiFRAdhuF14FMRBynALhehQ4RitN3%2FurF3xNWm%2FATOfjswMAKinyMfntv%2FFgqkVH8133BMlVy3qlGE2srC8Mk09eQgZss1jm63jcHtRpEUy6RPalRWTdFmFpJPwiig1bxLMnyi1UQ%2F17I10hO9fBPG8oXH%2BQH9e66Y4%3D"},{name:Object(n.i18n)("jindong_shopping"),uuid:"6dcbbe4e9dc6ef2fd68da7d8befd117c",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/cee009549b352def723ba09d6da4b742.png",type:"web",target:"https://www.infinitynewtab.com/jd.pro.html"},{name:Object(n.i18n)("xie_cheng"),uuid:"afe7a96e6db449e6199df118756d5672",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/f6ec2e6ee20fe198f81cf620413bc35b.png",bgType:"image",type:"web",target:"http://www.ctrip.com/?allianceid=1050724&sid=1786019"},{name:Object(n.i18n)("i_taobao"),uuid:"c4ba1648d4014bad7fdea130cd421589",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/346647fb95fbac4d303c93fa0a4936d3.png",type:"web",target:"https://ai.taobao.com/?pid=mm_50570328_39070332_145428725"}],default:[{uuid:"4299970b2e054e9a39450e6f854a684c",name:"Amazon",target:"https://i.infinitynewtab.com/amazon/",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/e67eed044bf08fbcac16a0527fcc165a.png",bgType:"image",type:"web"},{uuid:"912ed4e109a1cde4b956fa8a1670fae2",name:"eBay",target:"https://www.ebay.com?mkcid=1&mkrid=711-53200-19255-0&siteid=0&campid=5338095340&customid=infinity&toolid=10001&mkevt=1",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/ebay.png",bgType:"image",type:"web"},{uuid:"080772d54828d47e7f8ce223c66f36df",name:"Booking",target:"https://www.booking.com/index.html?aid=1267011",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/83e58c13ed40dc8393297d43d2639cce.png",bgType:"image",type:"web"},{uuid:"66117abb3659ad746baadc8c1e0b28df",name:"Twitter",target:"https://twitter.com",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/0c7e5d8b40c38cde576595b23546cc91.png",bgType:"image",type:"web"}]},g={name:Object(n.i18n)("weather"),uuid:"eed2a9287b324510678cd5e714888e99",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/assets/weather/default.png",type:"app",bgColor:"#36B3FF",target:"infinity://weather"},m=t=>{var e;return s()(e=[g,{name:Object(n.i18n)("todos"),uuid:"c09f31db43d7faca5bf659fadad3967c",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/6e49210c084629259f22609980c48ecf.png",type:"app",target:"infinity://todos"},{name:Object(n.i18n)("notes"),uuid:"ea5ac5d9e9e08c1d57ad413e9e38d376",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/006b88c07a2e87d5a61f3c969a70575c.png",type:"app",target:"infinity://notes"},a.l&&{name:Object(n.i18n)("history"),uuid:"4528cef4f8d66e661cb3143af733694e",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/history_2.png",type:"app",target:"infinity://history"},a.l&&{name:Object(n.i18n)("bookmarks"),uuid:"96646a13688f5bfd0aaf4811a579aee1",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/31a36139ccf4b9b005ec55445bf833b0.png",type:"app",target:"infinity://bookmarks"},{name:Object(n.i18n)("folder"),id:"folder-8001eiapfpq4dvihgz9dbn5dpmtpzu",uuid:"8001eiapfpq4dvihgz9dbn5dpmtpzu",children:[{name:"500px",uuid:"c5cb65ab55611b1d8bb2e09ad143b797",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/ee908304d3c7def64adc6b3e2aaac4df.png",type:"web",target:"https://500px.com"},{name:"9GAG",uuid:"739aca5f5ee9f27dd0ed29f03d58bd32",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/150127100951.png",type:"web",target:"http://www.9GAG.com"}]},...h[t]||h.default,{name:"Youtube",uuid:"60e546111669c1d829f962c8831a0926",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/37d396f9975e494b10ac8696d64ebb2a.png",type:"web",target:"https://youtube.com"},{name:Object(n.i18n)("exfans"),uuid:"6474696c6646280df5c4faa9b7fcae39",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/6474696c6646280df5c4faa9b7fcae39.png",type:"web",target:"https://extfans.com"},a.i&&{name:Object(n.i18n)("chrome_app_store"),uuid:"744e698c837a43c49fbd3e26753d7d3f",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/d2085270ca1ded965bfaac2d2a6b12dc.png",type:"web",target:"https://chrome.google.com/webstore/category/extensions"},a.k&&{name:Object(n.i18n)("edge_app_store"),uuid:"744e63c4998c83753d7d37a4fbd3e26f",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/eeedf66223852ae037aa58284858187d.png",type:"web",target:"https://microsoftedge.microsoft.com/addons"},a.n&&{name:Object(n.i18n)("firefox_app_store"),uuid:"743965befe82a5255fb48dcf7b848bbb",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/7ef4532818b99d9320879c3e4979fc01.png",type:"web",target:"https://addons.mozilla.org"},(a.i||a.k)&&{name:Object(n.i18n)("application"),uuid:"4e0da886cc15213d558a4c51b2623089",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/63cf498c5b3d20beaa0b1f38bda717f9.png",bgType:"image",type:"app",target:"infinity://chrome-apps"},{name:Object(n.i18n)("wallpaper_library"),uuid:"76e8e8a1cb47ef88dc9faaf52167aa9a",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/76e8e8a1cb47ef88dc9faaf52167aa9a.png",type:"app",target:"infinity://wallpaper"},(a.i||a.k)&&{name:Object(n.i18n)("extension"),uuid:"194dd7b46ac16ac93becf5386f14bcca",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/194dd7b46ac16ac93becf5386f14bcca.png",type:"app",target:"infinity://extension"},{name:Object(n.i18n)("settings"),uuid:"552fa3a378b29375843fa3d021cbe129",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/9622b98e90dd4f107d23481566095b34.png",type:"app",target:"infinity://settings"},{name:"Infinity Games",uuid:"5001b4d70b1c62f14859b51a6e8abd6f",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/icon/5001b4d70b1c62f14859b51a6e8abd6f.png",type:"web",target:"https://games.infinitynewtab.com/"},a.l&&{name:"Gmail",uuid:"01d0a35ebb602dde4dadd63887cc2a91",bgType:"image",bgImage:"https://infinityicon.infinitynewtab.com/user-share-icon/gmail_2.png",type:"app",target:"infinity://gmail"}].filter(t=>!!t)).call(e,(t,e,i)=>{e.id||(e.id="siteId-"+e.uuid),e.updatetime=0,e.children&&e.children.forEach(t=>{t.id="siteId-"+t.uuid,t.updatetime=0});const o=Math.floor(i/10);return t[o]||(t[o]=[]),t[o].push(e),t},[])},y=[{name:Object(n.i18n)("all_wallpaper_sources"),value:"all",desc:Object(n.i18n)("all_wallpaper_sources_desc"),img:Object(r.a)("source-all.png",!0)},{name:Object(n.i18n)("infinity_landscape_wallpaper_source"),value:"InfinityLandscape",desc:Object(n.i18n)("infinity_landscape_wallpaper_source_desc"),img:Object(r.a)("source-infinity-landscape.png",!0)},{name:Object(n.i18n)("infinity_comic_wallpaper_source"),value:"Infinity",desc:Object(n.i18n)("infinity_comic_wallpaper_source_desc"),img:Object(r.a)("source-infinity-comic.png",!0)},{name:"Bing",value:"bing",desc:Object(n.i18n)("bing_wallpaper_source_desc"),img:Object(r.a)("source-bing.png",!0)},{name:"Unsplash",value:"Unsplash",desc:Object(n.i18n)("unsplash_wallpaper_source_desc"),img:Object(r.a)("source-unsplash.png",!0)},{name:"Life Of Pix",value:"Life Of Pix",desc:Object(n.i18n)("life_of_pix_wallpaper_source_desc"),img:Object(r.a)("source-life-of-pix.png",!0)},{name:"MMT",value:"MMT",desc:Object(n.i18n)("mmt_wallpaper_source_desc"),img:Object(r.a)("source-mmt.png",!0)},{name:"Realistic Shots",value:"Realistic Shots",desc:Object(n.i18n)("realistic_shots_wallpaper_source_desc"),img:Object(r.a)("source-realistic-shots.png",!0)},{name:"Jay Mantri",value:"Jay Mantri",desc:Object(n.i18n)("jay_mantri_wallpaper_source_desc"),img:Object(r.a)("source-jay-mantri.png",!0)},{name:"Free Nature Stock",value:"Free Nature Stock",desc:Object(n.i18n)("free_nature_stock_wallpaper_source_desc"),img:Object(r.a)("source-free-nature-stock.png",!0)},{name:"Skitter Photo",value:"Skitter Photo",desc:Object(n.i18n)("skitter_photo_wallpaper_source_desc"),img:Object(r.a)("source-skitter-photo.png",!0)},{name:"Startup Stock Photos",value:"Startup Stock Photos",desc:Object(n.i18n)("startup_stock_wallpaper_source_desc"),img:Object(r.a)("source-startup-stock-photos.png",!0)},{name:"Barn Images",value:"Barn Images",desc:Object(n.i18n)("barn_images_wallpaper_source_desc"),img:Object(r.a)("source-barn.png",!0)},{name:"Picography",value:"Picography",desc:Object(n.i18n)("picography_wallpaper_source_desc"),img:Object(r.a)("source-picography.png",!0)}],b=["c00018","de8930","f7d946","cbe582","506f37","60a8d8","184878","be7ab9"],f=["action","aerial","bokeh","close-ups","curves","glare","landmarks","laptop","light rays","long-exposure"]},241:function(t,e,i){"use strict";i.d(e,"g",(function(){return g})),i.d(e,"d",(function(){return y})),i.d(e,"e",(function(){return w})),i.d(e,"j",(function(){return v})),i.d(e,"k",(function(){return O})),i.d(e,"c",(function(){return j})),i.d(e,"h",(function(){return S})),i.d(e,"i",(function(){return k})),i.d(e,"l",(function(){return C})),i.d(e,"a",(function(){return L})),i.d(e,"b",(function(){return x})),i.d(e,"f",(function(){return E}));var o=i(7),s=i.n(o),n=i(48),a=i.n(n),r=(i(10),i(17),i(44),i(52),i(0)),c=i(21),l=i(26),d=i.n(l),p=i(23);const u=document.querySelector(".wallpaper"),h="store-wallpaper-cache",g=t=>d.a.setItem("infinity-image-base64",t),m=c.a.debounce(async t=>{t&&t.currentP&&t.currentP.url&&"local"===t.type&&delete t.currentP.url,await d.a.setItem(h,t)},1e3/60),y=async()=>{try{const t=await d.a.getItem("infinity-image-base64");if(t)return t;if(!r.r){const t=(await new s.a(t=>chrome.storage.local.get("infinity-image-base64",t)))["infinity-image-base64"];if(t)return await d.a.setItem("infinity-image-base64",t),await new s.a(t=>chrome.storage.local.remove("infinity-image-base64",t)),t}throw new Error("throw")}catch(t){throw new Error("cannot find base64 url of current wallpaper")}},b="first-installed",f={},w=()=>JSON.parse(JSON.stringify(f)),v=t=>{Object.assign(f,t),m(f)};const O=t=>d.a.setItem(h,t);async function _(t){let e;return e=await fetch(t).then(t=>t.blob()),e}const j=t=>new s.a(e=>{const i=document.createElement("img");i.onload=()=>e(!0),i.onerror=()=>e(!1),i.src=t}),I=t=>new s.a(e=>{let i=document.createElement("img");i.onload=()=>e(!0),i.onerror=()=>e(!1),i.src=t,setTimeout(()=>{i.src="",i=null,e(!1)},150)}),S=t=>{u.style.backgroundImage&&(u.style.backgroundImage=""),u.style.backgroundColor=t},k=t=>{u.style.backgroundColor&&(u.style.backgroundColor=""),p.c&&(t=t.replace(C,"")),u.style.backgroundImage=`url(${t})`},C="format/webp/",L="https://infinitypro-img.infinitynewtab.com/findaphoto/bigLink/default.png",x=`${L}?imageView2/2/w/${screen.width}/${p.c?"":C}interlace/1`,R=()=>{const t=[i(354),"https://infinitypro-img.infinitynewtab.com/findaphoto/bigLink/default.png"];return new s.a(e=>{let i=!1;t.forEach(t=>{const o=new Image;o.addEventListener("load",async()=>{if(!i){i=!0;v({fallback:!0}),k(t),e(t)}}),o.src=t})})},E=async()=>{const t=(t=40,e=0)=>{const i={"--wallpaper-alpha":t/100,"--wallpaper-filter":e/5+"px"};Object.keys(i).forEach(t=>{document.body.style.setProperty(t,i[t])})};if(!localStorage.getItem(b))return t(),v(f),localStorage.setItem(b,"1"),void await R();const e=await async function(){const t=await d.a.getItem(h);if(t)return t;if(!r.r){const t=(await new s.a(t=>chrome.storage.local.get(t)))[h];if(t)return await d.a.setItem(h,t),await new s.a(t=>chrome.storage.local.remove(h,t)),t}return{}}();t(e.opacity,e.blur);const i=async t=>{const{url:e}=t;if(await I(e))return void k(e);const i=await y();if(i){const t=await _(i),e=a.a.createObjectURL(t);k(e)}else await R()};v(e);try{switch(e.type){case"local":await(async t=>{const{currentP:e}=t,i=JSON.parse(localStorage.getItem("__wp__clean")),{rawUrl:o}=e;if(!i){if(await I(o))return void k(o)}const s=await y();if(s){const i=await _(s),o=a.a.createObjectURL(i);return e.rawUrl=o,v(t),void k(o)}return await R()})(e);break;case"bing":case"cloud":await i(e.currentP);break;case"color":await(async t=>{const{color:e}=t;e?S(e):await R()})(e);break;case"userLibraryAuto":case"cloudAuto":await(async t=>{const{currentP:e}=t;if(t.oneP)return void await i(e);if(!t.ready)return await i(e);if("when-newtab"!==t.switchType&&t.timeEnd>Date.now())return void await i(e);t.ready=!1;const{nextP:o}=t;t.currentP=Object.assign({},o),delete t.nextP,v(t),await(async t=>{const{url:e}=t;await I(e)?k(e):await R()})(o)})(e);break;case"default":default:await R()}}catch(t){console.log("something error got catch: ",t),await R()}localStorage.removeItem("__wp__clean")}},337:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"f",(function(){return c})),i.d(e,"a",(function(){return l})),i.d(e,"c",(function(){return d})),i.d(e,"e",(function(){return p})),i.d(e,"d",(function(){return u}));var o=i(7),s=i.n(o),n=(i(10),i(13),i(16),i(0)),a=i(188);function r(t){let e=0;switch(t){case"per-hour":e=n.q?36e5:2e4;break;case"twelve-hour":e=432e5;break;case"one-day":e=864e5}return e}async function c(t){let e;var i;return e="string"==typeof t?await(i=t,fetch(i).then(t=>t.blob())):t,await new s.a((t,i)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>{t(o.result)},o.onerror=i})}function l(t,e="cloud"){return t.map(t=>({type:e,id:t._id,url:t.url,content:t.thumbnail,like:t.like,source:t.source,rawUrl:t.rawUrl}))}async function d(){const t=await Object(a.getBingWallpaper)();if(t.error)throw t.error;const[e]=l([t.data]);return e}function p(t){return!["image/gif"].includes(t.type)&&t.size>window.__INFINITY__.maxLocalFileSize}async function u(){const t=await Object(a.getCustomColor)();if(!t.error)return t.data.map(t=>(t.type="color",t));console.warn(t.error)}},338:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return n}));var o=i(196);const s={notice:{gmail:!1,gmailVoice:!1,gmailNumber:!1,todoNumber:!0},link:{icon:!!i(0).r,search:!0,bookmark:!1,history:!1},view:{topBookmark:!1,topUseful:!1,windmill:!0,pagin:!1,isShowHomepageBtn:!0,scaleSide:1,scaleMain:1},layout:{row:2,col:5,rowGap:.2,colGap:.3,custom:!1,customItem:[3,4]},animation:{easing:"linear"},icon:{miniMode:!1,shadow:!1,startAnimation:!1,opacity:1,radius:.5,scale:.5,isHideIconName:!1},search:{hide:!1,searchSuggest:!0,hideCategory:!1,hideButton:!0,shadow:!0,scale:.82,radius:o.i,opacity:1},font:{shadow:!0,size:15,color:"rgb(221, 221, 221)"}},n=function(t,e){let i=null;switch(t+"*"+e){case"2*4":case"2*5":i={iconScale:.5,colGap:.3,rowGap:.2,searchScale:.82};break;case"2*6":i={iconScale:.6,colGap:.3,rowGap:.3,searchScale:.9};break;case"2*7":i={iconScale:.7,colGap:.3,rowGap:.3,searchScale:.9};break;case"3*3":i={iconScale:.7,colGap:.24,rowGap:.2,searchScale:.82}}return i}},354:function(t,e,i){t.exports=i.p+"images/wallpaper.c4eff18.webp"},375:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));const o=t=>{const e=s(t),i=n(t,e);return{searchWidth:e.width,searchHeight:e.height,searchMarginTop:e.marginTop,searchMarginBottom:e.marginBottom,searchRatio:e.searchRatio,iconBoxWidth:i.boxWidth,iconBoxHeight:i.boxHeight,iconOneHeight:i.iconOneHeight,iconWidth:i.width,miniIconPadding:i.miniIconPadding,iconRatio:i.iconRatio,iconsMargin:i.iconsMargin}},s=t=>{const{searchScale:e,innerHeight:i,innerWidth:o,miniMode:s,topBookmark:n,topUseful:a,mainRatio:r}=t;let c=0;a&&(c+=36),n&&(c+=36);const l=i-c,d=o-.2*o;let p=o,u=9*p/16;u>l&&(u=l,p=16*u/9);const h=p*(.575-.1818*Math.max(Math.min(720,p-1200),0)/720),g={width:h*e,height:u*(.0963-.0296*Math.max(Math.min(405,u-675),0)/405)*e};g.width>d&&(g.height=d/g.width*g.height,g.width=d);const m={width:g.width*r,height:g.height*r};let y=null;y=s?-.3:-.06;const b=g.width/h*r,f=Math.floor(y*l*b)+"px",w=Math.floor(.775*m.height)+"px";return{width:Math.floor(m.width)+"px",height:Math.floor(m.height)+"px",searchRatio:Number((m.width/625).toFixed(2)),marginTop:f,marginBottom:w,appContentWidth:d,appContentHeight:l,searcherSizeWithRatio:g}},n=(t,e)=>{const{row:i,col:o,rowGap:s,colGap:n,iconScale:a,innerWidth:r,mainRatio:c,fontSize:l}=t;let d=r;d<1200?d=1200:d>1920&&(d=1920);const{appContentHeight:p,appContentWidth:u,searcherSizeWithRatio:h}=e,g=u,m=.8*p-2.451*h.height,y=1+.5*(1920-d)/720,b=g/o,f=m/i,w=Math.min(Math.min(b,f)*a*y,b,f),v=(m-i*w)/i*s/2,O=o*(w+2*((g-o*w)/o*n/2));let _=Math.min(Math.ceil(O*c),r);let j=i*(w+2*v)*c;const I=w*c,S=1.3*Math.max(l*c,12)+.9*I*.08,k=1.2*(25+S);_<o*k&&(_=o*k),j<i*k&&(j=i*k);let C=.9*I-S-1;C<25&&(C=25);const L=.1*r*c;return{width:Math.floor(C)+"px",miniIconPadding:Math.floor(C/7+4)+"px",boxWidth:Math.ceil(_)+"px",boxHeight:Math.floor(j)+"px",iconOneHeight:Math.floor(j/i)+"px",iconRatio:Number((C/106).toFixed(2)),iconsMargin:Math.floor(L)+"px"}}},461:function(t,e,i){"use strict";i.r(e),i.d(e,"syncStore",(function(){return R}));var o=i(7),s=i.n(o),n=i(104),a=i.n(n),r=(i(13),i(16),i(10),i(52),i(17),i(8)),c=i(81),l=i(363),d=i(475),p=i(470),u=i(476),h=i(469),g=i(472),m=i(477),y=i(364),b=i(473),f=i(1),w=i(242),v=f.b`.container {
  width: 410px;
  box-sizing: border-box;
  padding: 40px 40px 34px 40px;
  background: #ffffff;
  border-radius: 6px;
}
.header {
  text-align: center;
  line-height: 30px;
  height: 28px;
  font-size: 20px;
  font-weight: 500;
  color: #333333;
  line-height: 28px;
}
.main {
  margin: 24px auto 40px;
}
.tips {
  margin-bottom: 30px;
  font-size: 14px;
  font-weight: 400;
  color: #656565;
  line-height: 20px;
}
.checkbox {
  display: flex;
  align-items: center;
  position: relative;
  margin-bottom: 20px;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  cursor: pointer;
}
.checkbox .input-box {
  display: flex;
  align-items: center;
  position: relative;
}
.checkbox label {
  box-sizing: border-box;
  position: absolute;
  top: 0;
  left: 0;
  width: 16px;
  height: 16px;
  border: 2px solid #333;
  border-radius: 8px;
  cursor: pointer;
}
.checkbox label::after {
  content: '';
  width: 9px;
  height: 5px;
  position: absolute;
  top: 1px;
  left: 1px;
  border: 2px solid #333;
  border-top: none;
  border-right: none;
  background: transparent;
  opacity: 0;
  transform: rotate(-45deg);
}
.checkbox input {
  visibility: hidden;
}
.checkbox input:checked + label::after {
  opacity: 1;
}
.checkbox:last-of-type {
  margin-bottom: 0;
}
.btn {
  width: 330px;
  height: 52px;
}
`,O=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};let _=class extends w.a{constructor(){super(...arguments),this.onChecked=t=>{},this.show=!1,this.checked=0,this.handleCheck=t=>{this.show=!1,"function"==typeof this.onChecked&&this.onChecked(t),this.checked=0,this.onChecked=()=>{}}}static create(t){const e=document.body.querySelector("#modal-first-sync");if(e){if(!this.instance){const t=document.createElement("modal-first-sync");e.appendChild(t),this.instance=t}return this.instance.show=!0,this.instance.onChecked=t,this.instance}}static hide(){this.instance&&this.instance.show&&this.instance.handleCheck(null)}firstUpdated(){}checkOne(t){this.checked=t}updated(){this.radios[this.checked].checked=!0}render(){return f.e`<infinito-modal style="--modal-padding:0;" .closeable="${!1}" .open=${this.show}>
      <div slot="body">
        <div class="container">
          <div class="header">${i18n("choose_sync_type")}</div>
          <div class="main">
            <div class="tips">${i18n("sync_type_tips")}</div>
            <div class="checkbox-box">
              <div class="checkbox" @click="${()=>this.checkOne(0)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="0" id="first_sync_0" />
                  <label for="first_sync_0"></label>
                </div>
                <span>${i18n("merge_cloud_local")}</span>
              </div>
              <div class="checkbox" @click="${()=>this.checkOne(1)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="1" id="first_sync_1" />
                  <label for="first_sync_1"></label>
                </div>
                <span>${i18n("use_local")}</span>
              </div>
              <div class="checkbox" @click="${()=>this.checkOne(2)}">
                <div class="input-box">
                  <input name="first_sync" type="radio" value="2" id="first_sync_2" />
                  <label for="first_sync_2"></label>
                </div>
                <span>${i18n("use_cloud")}</span>
              </div>
            </div>
          </div>
          <div class="footer">
            <infinito-button
              primary
              class="btn"
              @click="${()=>{this.handleCheck(this.checked)}}"
              >${i18n("confirm")}</infinito-button
            >
          </div>
        </div>
      </div>
    </infinito-modal> `}};_.styles=v,_.instance=null,O([Object(f.g)()],_.prototype,"onChecked",void 0),O([Object(f.g)({type:Boolean})],_.prototype,"show",void 0),O([Object(f.g)({type:Number})],_.prototype,"checked",void 0),O([Object(f.i)('[name="first_sync"]')],_.prototype,"radios",void 0),_=O([Object(f.c)("modal-first-sync")],_);var j=i(174),I=i(0),S=i(337),k=i(345),C=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};const L=[p.b,d.a,h.a,u.a,g.a,m.a,b.weatherStore];class x extends l.a{constructor(){super(...arguments),this.timmer=null,this.downloading=!1,this.backuping=!1,this.isBackup=!1,this.isOpenSync=!0,this.syncId="",this.lastSyncTime=0,this.syncSucsess=!1,this.syncFail=!1,this.syncFailMsg="",this.autosSyncList=[],this.waitMergeData=null,this.waitMergeId=null,this.manualSyncList=[],this.isRecovered=!1,this.recoverErrorTimes=0,this.master=!1,this.prerender=[],this.autoBackupPipe={data:{},websocketKeys:[],timestamp:0},this.getAllBackupData=async()=>{const t={};return await s.a.all(L.map(async e=>{const i=await e.getBackupData();t[e.backupFileKey]=i})),t},this.getAutoLatest=async(t="all")=>{const e=localStorage.getItem("lock-auto-recover");if(e&&Date.now()-Number(e)<50)return;if(localStorage.setItem("lock-auto-recover",""+Date.now()),await this.getSyncList(),0===this.autosSyncList.length){const t=y.userStore.userInfo["backup-version-v2"];if(y.userStore.userInfo["auto-backup"]&&!t){const t=y.userStore.userInfo.email?"basic":"pro";await this.getV1RemoteData(t)}else this.tiggerBackup();return}const i=this.autosSyncList[0];if((null==i?void 0:i.id)===this.syncId||this.waitMergeId===(null==i?void 0:i.id))return;const o=localStorage.getItem("pre-sync-id");o&&(null==i?void 0:i.id)===o||(await this.getDetail(i.id,"auto",t,!1,!0),localStorage.removeItem("lock-auto-recover"))},this.changeSyncStatus=t=>{this.master=!1,this.downloading=t.downloading,this.backuping=t.backuping,this.isBackup=t.isBackup,this.syncFail=t.syncFail,this.syncFailMsg=t.syncFailMsg,this.syncSucsess=t.syncSucsess,(this.syncSucsess||this.syncFail)&&this.syncEnd()}}get autoSyncing(){return this.downloading||this.backuping}async changeSyncSwitch(t){this.isOpenSync=t}async autoBackup(t,e=""){const i=await this.toSync(!0,t,e);return i.error||Object(r.i)(()=>{this.autosSyncList=i.data}),i}async manualBackup(){const{default:t}=await Promise.resolve().then(i.bind(null,344)),e=t.loading(i18n("backing_up")),{error:o,data:s}=await this.toSync();e(),o?t.error(i18n("backup_failed")):Object(r.i)(()=>{this.manualSyncList=s})}async toSync(t=!1,e={},i=""){var o,n;let a;if(this.master=!0,t)this.isBackup=!0,this.backuping=!0,a=await c.e.autoBackup(e,i);else{const t={};await s.a.all(L.map(async e=>{const i=await e.getBackupData();t[e.backupFileKey]=i})),a=await c.e.manualBackup(t)}const{error:r,data:l=[]}=a;return t&&(r||j.slave.postTask("slave:sync-to-server",i),r?this.backupEnd(r.message||"auto-backup error",null===(o=l[0])||void 0===o?void 0:o.id):this.backupEnd(null,null===(n=l[0])||void 0===n?void 0:n.id)),a}backupEnd(t,e=""){Object(r.i)(()=>{this.master=!0,this.backuping=!1,t?this.syncFail=!0:(this.syncSucsess=!0,e&&(this.syncId=e,this.lastSyncTime=Date.now()))}),this.syncEnd()}downloadEnd(t,e=""){Object(r.i)(()=>{this.master=!0,this.downloading=!1,this.backuping=!1,t?this.syncFail=!0:(this.syncSucsess=!0,e&&(this.syncId=e,this.lastSyncTime=Date.now()))}),this.syncEnd()}syncEnd(){clearTimeout(this.timmer),this.timmer=setTimeout(()=>{Object(r.i)(()=>{this.syncFail=!1,this.syncFailMsg="",this.syncSucsess=!1,this.isBackup=!1})},3e3)}async getSyncList(){const{data:t,error:e}=await c.e.getSyncList();if(e)throw e;Object(r.i)(()=>{this.autosSyncList=t.auto,this.manualSyncList=t.manual})}async getDetail(t,e,o="all",s=!1,n=!1){let a,r;if(this.master=!0,s){const{default:t}=await Promise.resolve().then(i.bind(null,344));a=t,r=a.loading(i18n("syncing"))}else this.downloading=!0,this.isBackup=!1;const{data:l,error:d}=await c.e.getSyncDetail(n?"latest":t,e,o);s&&(null==r||r()),d?s?null==a||a.error(i18n("sync_fail")):this.downloadEnd(d.message||"download error"):(await this.useRemote(l,s),this.downloadEnd(null,t),this.tiggerBackup())}tiggerBackup(){var t;this.changeRecoveredStatus(!0),(null===(t=this.autoBackupPipe.websocketKeys)||void 0===t?void 0:t.length)&&(this.autoBackupPipe.timestamp=Date.now())}async getV1RemoteData(t,e=!1){let o,s;if(this.master=!0,e){const{default:t}=await Promise.resolve().then(i.bind(null,344));o=t,s=o.loading(i18n("syncing"))}else this.downloading=!0,this.isBackup=!1;const{error:n,data:a}=await c.e.getV2DataFromV1(t);e&&(null==s||s()),n?(e?null==o||o.error(i18n("sync_fail")):this.downloadEnd(n.message||"download v1 error"),this.recoverErrorTimes+=1):(this.downloadEnd(null),await this.useRemote(a,e,!0),this.tiggerBackup())}changeRecoveredStatus(t){this.isRecovered=t}autoRunGetAutoLatest(){setTimeout(()=>{this.getAutoLatest()},0)}showModalAndCheckType(t=!1){return new s.a((e,i)=>{var o;if(t&&_.hide(),null===(o=_.instance)||void 0===o?void 0:o.show)return void e(null);const n=Object(r.j)(this.waitMergeData);_.create(async o=>{this.mergeType=o,this.diffColorItems();try{await s.a.all(L.map(async t=>{if(n&&n[t.backupFileKey])if(1===o)t.restartAutoBackupReaction(!0);else if(2===o)try{await t.mergeRemote(n[t.backupFileKey],!0)}catch(t){}else{if(0!==o)throw new Error("not check");try{await t.mergeRemote(n[t.backupFileKey],!1)}catch(t){}t.restartAutoBackupReaction(!0)}})),this.downloadEnd(null,this.waitMergeId),this.tiggerBackup(),Object(r.i)(()=>{this.waitMergeData=null,this.waitMergeId=null})}catch(e){t&&i(e)}e(null)})})}useLocalData(t){L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){console.error("Store ~ syncStores.map ~ error",t)}})}useRemote(t,e,i=!1){return new s.a(async o=>{if(Object(r.i)(()=>{this.waitMergeData=null,this.waitMergeId=null}),e)await s.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}})),this.mergeType=2,this.diffColorItems(),o(null);else if(this.isRecovered)await s.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])if(i)try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}else{e.stopAutoBackupReaction();try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}e.restartAutoBackupReaction()}})),o(null);else{L.some(e=>{if(t&&t[e.backupFileKey]){console.log("diffData ~ st.backupFileKey",e.backupFileKey);return e.diffRemote(t[e.backupFileKey])}return!1})?(Object(r.i)(()=>{var e;this.waitMergeData=t,this.waitMergeId=null===(e=this.autosSyncList[0])||void 0===e?void 0:e.id}),await this.showModalAndCheckType(!0),o(null)):(this.mergeType=2,this.diffColorItems(),await s.a.all(L.map(async e=>{if(null==t?void 0:t[e.backupFileKey])try{await e.mergeRemote(t[e.backupFileKey],!0)}catch(t){}})),o(null))}})}pushAutoBackupPipe(t){y.userStore.isLogin&&this.isOpenSync&&(Object.keys(t).forEach(e=>{this.autoBackupPipe.data[e]=t[e],this.autoBackupPipe.websocketKeys.includes(e)||this.autoBackupPipe.websocketKeys.push(e)}),this.autoBackupPipe.timestamp=Date.now())}cleanupPipe(t){t===this.autoBackupPipe.timestamp&&(this.autoBackupPipe={data:{},websocketKeys:[],timestamp:0})}async diffColorItems(){await y.userStore.userProfilePromise;const t=y.userStore.userInfo["wp-color-update"];if(t===y.userStore.wpColorUpdate)return;const{mergeType:e}=this,i=await Object(S.d)(),o=Object(r.j)(h.a.customColorItems);await h.a.mergeCustomColor(o,i,Number(e),!0),y.userStore.setWpColorUpdate(t)}}C([r.g],x.prototype,"downloading",void 0),C([r.g],x.prototype,"backuping",void 0),C([r.g],x.prototype,"isBackup",void 0),C([r.g],x.prototype,"isOpenSync",void 0),C([r.g],x.prototype,"syncId",void 0),C([r.g],x.prototype,"lastSyncTime",void 0),C([r.g],x.prototype,"syncSucsess",void 0),C([r.g],x.prototype,"syncFail",void 0),C([r.g],x.prototype,"syncFailMsg",void 0),C([r.g],x.prototype,"autosSyncList",void 0),C([r.g],x.prototype,"waitMergeData",void 0),C([r.g],x.prototype,"waitMergeId",void 0),C([r.g],x.prototype,"manualSyncList",void 0),C([r.g],x.prototype,"isRecovered",void 0),C([r.g],x.prototype,"recoverErrorTimes",void 0),C([r.g],x.prototype,"master",void 0),C([r.g],x.prototype,"prerender",void 0),C([r.g],x.prototype,"autoBackupPipe",void 0),C([r.e],x.prototype,"autoSyncing",null),C([r.b],x.prototype,"changeSyncSwitch",null),C([r.b],x.prototype,"autoBackup",null),C([r.b],x.prototype,"manualBackup",null),C([r.b],x.prototype,"toSync",null),C([r.b],x.prototype,"backupEnd",null),C([r.b],x.prototype,"downloadEnd",null),C([r.b],x.prototype,"syncEnd",null),C([r.b],x.prototype,"getSyncList",null),C([r.b],x.prototype,"getDetail",null),C([r.b],x.prototype,"tiggerBackup",null),C([r.b],x.prototype,"getV1RemoteData",null),C([r.b],x.prototype,"changeRecoveredStatus",null),C([r.b],x.prototype,"getAutoLatest",void 0),C([r.b],x.prototype,"pushAutoBackupPipe",null),C([r.b],x.prototype,"cleanupPipe",null),C([r.b],x.prototype,"changeSyncStatus",void 0);const R=new x;R.initSyncStore("store-sync",["autoBackupPipe","syncId","lastSyncTime","isOpenSync","isRecovered","recoverErrorTimes","prerender","waitMergeData","waitMergeId"],void 0,!0,50);Object(r.c)(()=>{var t;if(R.firstSync){const{isOpenSync:e,isRecovered:i,downloading:o}=R;if(y.userStore.isLogin&&e&&i&&!o&&!(null===(t=_.instance)||void 0===t?void 0:t.show)){const{data:t,websocketKeys:e,timestamp:i}=R.autoBackupPipe;(async t=>{const{data:e,websocketKeys:i,timestamp:o}=t,n=Object.assign({},e);if(Object.keys(n).length)try{const t=localStorage.getItem("lock-auto-backup");if(t&&Date.now()-Number(t)<4e3)return;localStorage.setItem("lock-auto-backup",""+Date.now()),0===R.autosSyncList.length?await s.a.all(L.map(async t=>{const e=await t.getBackupData();n[t.backupFileKey]=e})):await s.a.all(L.map(async t=>{if(i.includes(t.backupFileKey)){const e=await t.getBackupData();n[t.backupFileKey]=e}}));const{error:e}=await R.autoBackup(Object(r.j)(n),i.join(","));if(e)return;R.cleanupPipe(o),localStorage.removeItem("lock-auto-backup")}catch(t){}})({data:t,websocketKeys:e,timestamp:i})}}},{delay:4e3}),Object(r.c)(()=>{if(R.firstSync){const t=R.isOpenSync&&y.userStore.isLogin;j.slave.postTask("slave:change-sync",{status:t,userInfo:{uid:y.userStore.userInfo.uid,secret:y.userStore.userInfo.secret}}),t?R.autoRunGetAutoLatest():y.userStore.isLogin&&R.getSyncList()}},{delay:100}),Object(r.c)(()=>{R.firstSync&&(R.isOpenSync&&y.userStore.isLogin||(R.changeRecoveredStatus(!1),Object(r.i)(()=>{R.syncId="",R.waitMergeId=null,R.waitMergeData=null}),localStorage.removeItem("pre-sync-id")))}),Object(r.c)(()=>{R.firstSync&&y.userStore.isLogin&&0===y.userStore.userInfo["auto-backup"]&&0===R.autosSyncList.length&&d.a.restartAutoBackupReaction(!0)}),Object(r.c)(()=>{if(R.firstSync&&R.master){const t={downloading:R.downloading,backuping:R.backuping,syncSucsess:R.syncSucsess,syncFail:R.syncFail,syncFailMsg:R.syncFailMsg,isBackup:R.isBackup};j.slave.sendMessage("tabs-sync-status",t)}},{delay:20}),Object(r.c)(()=>{var t;R.firstSync&&R.autosSyncList.length&&(R.waitMergeId===(null===(t=R.autosSyncList[0])||void 0===t?void 0:t.id)?R.showModalAndCheckType():_.hide())},{delay:1}),window.addEventListener("beforeunload",()=>{R.master&&j.slave.sendMessage("tabs-sync-status",{downloading:!1,backuping:!1,syncSucsess:!1,syncFail:!1,syncFailMsg:"",isBackup:!1})}),Object(r.h)(()=>R.firstSync,async t=>{if(t){const t=await E();k.a.trySendStatus(t)}},{delay:1e3});const E=async()=>({currentIsLogin:!!y.userStore.isLogin,currentIsOpenSync:y.userStore.isLogin&&R.isOpenSync,currentSearchEngine:u.a.searchEngine.current.types[0].url.split("?")[0],currentWallpaper:(()=>{try{const t=h.a.type,e=["userLibraryAuto","cloudAuto"],i=["cloud","color"];if(["local","default","bing"].includes(t))return t;if(e.includes(t))return{[t]:h.a.switchType};if(i.includes(t))return"color"===t?{[t]:h.a.color}:{[t]:h.a.rawUrl}}catch(t){return"error"}})(),currentIconCount:(()=>{try{var t;const e=a()(t=d.a.sites).call(t,(t,e)=>{if(null==e?void 0:e.length){return t+a()(e).call(e,(t,e)=>{var i;return(null===(i=null==e?void 0:e.children)||void 0===i?void 0:i.length)?t+e.children.length:t+1},0)}return t},0);return 10*Math.round(e/10)}catch(t){return"error"}})(),currentVersion:I.B.extVersion,currentBrowserEnv:I.c,currentRunBrowser:I.B.runtimePlatform});k.a.sendPageView({page:"newtab"})},469:function(t,e,i){"use strict";i.d(e,"a",(function(){return T}));var o=i(104),s=i.n(o),n=i(471),a=i.n(n),r=i(48),c=i.n(r),l=i(7),d=i.n(l),p=(i(17),i(44),i(52),i(13),i(16),i(10),i(487),i(8)),u=i(241),h=i(363),g=i(120),m=i(0),y=i(482),b=i(479),f=i(174),w=i(337);function v(){f.slave.postTask("slave:bg-run-clear-wallpaper-timer-task")}async function O(t){let e;return e=await fetch(t).then(t=>t.blob()),e}var _=i(364),j=i(188),I=i(499),S=i.n(I),k=i(21),C=i(480),L=i(344),x=i(23),R=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};const E=i(354);class P extends h.a{constructor(){super(),this.url=E,this.urlInUI=E,this.rawUrl=E,this.setWpSouceCount=t=>this.wpSourceCount=t,this.type="default",this.switchType="disabled",this.setSwitchType=t=>{this.switchType=t,this._updateTimer(!0)},this.setWpSourceCount=t=>this.wpSourceCount=t,this.wpExt="png",this.list=[],this.index=-1,this.timeEnd=0,this.remoteData=[],this.opacity=40,this.blur=0,this.setOpacity=t=>this.opacity=t,this.setBlur=t=>this.blur=t,this.liked=[],this.setLiked=t=>{this.liked=t},this.customColorItems=[],this.setCustomColorItems=t=>this.customColorItems=t,this._rgbaToHex=t=>{const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(e[3]||"1"),o=Math.floor(i*parseInt(e[0])+255*(1-i)),s=Math.floor(i*parseInt(e[1])+255*(1-i)),n=Math.floor(i*parseInt(e[2])+255*(1-i));return("0"+o.toString(16)).slice(-2)+("0"+s.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)},this._maxCollectionlen=100,this.cloudCollection=[],this.appendCloudCollection=t=>this.cloudCollection.push(t),this.setCloudCollection=t=>this.cloudCollection=t,this._maxRecentUsedLen=100,this.cloudRecentUsedOrder={},this.setCloudRecentUsedOrder=t=>{const{cloudRecentUsedOrder:e,cloudRecentUsed:i}=this,o={};Object.keys(e).forEach(t=>{i.includes(t)&&(o[t]=e[t])}),o[t]=Date.now(),this.cloudRecentUsedOrder=o},this.cloudRecentUsed=[],this.setCloudRecentUsed=t=>{const e=Object.keys(this.cloudRecentUsedOrder);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),e.length>0&&e.forEach(t=>{delete this.localRecentUsedOrder[t]}),this.cloudRecentUsed=t},this.appendCloudRecentUsed=t=>{this.cloudRecentUsed.push(t),this.cloudRecentUsed=Array.from(new Set(this.cloudRecentUsed))},this.localRecentUsedOrder={},this.setLocalRecentUsedOrder=t=>{this.localRecentUsedOrder[t]=Date.now()},this.localRecentUsed=[],this.setLocalRecentUsed=t=>{const e=Object.keys(this.localRecentUsedOrder);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),e.length>0&&e.forEach(t=>{delete this.localRecentUsedOrder[t]}),this.localRecentUsed=t},this.appendLocalRecentUsed=t=>{this.localRecentUsed.push(t),this.localRecentUsed=Array.from(new Set(this.localRecentUsed))},this.isLibraryItem=t=>t.includes(window.__INFINITY__.wpLibraryItemId),this.isLocal=t=>t.includes(window.__INFINITY__.wpId),this.isColorItem=t=>t.includes(window.__INFINITY__.wpColorId),this.isCurrentWp=t=>this.id===t,this.diffRemote=t=>{const e=["type","switchType","timeEnd","id","wpSource","opacity","blur","customColorItems"],i=Object.keys(t).every(i=>!e.includes(i)||p.d.structural(this[i],t[i]));let o=!1;return"local"!==t.type&&t.url&&(o=this.urlInUI!==t.url),!i||o},this.nextPage=0,this.totalPage=-1,this.delay=-1,this._whenLocalSynced=()=>{const t=Object(u.e)(),e=!(this.isAuto&&!t.ready);switch(e&&this.stopAutoBackupReaction&&this.stopAutoBackupReaction(),t.type){case"local":this._setLocalAfterInit(t);break;case"cloudAuto":case"userLibraryAuto":this._setCloudAutoAfterInit(t);break;case"bing":case"color":case"cloud":break;case"default":default:this._setDefaultAfterInit(t)}switch(function(t){Object(p.c)(()=>{const{opacity:e,blur:i}=t,o={"--wallpaper-alpha":e/100,"--wallpaper-filter":i/5+"px"};Object.keys(o).forEach(t=>{document.body.style.setProperty(t,o[t])}),Object(u.j)({opacity:e,blur:i})},{delay:0}),Object(p.h)(()=>t.type,e=>{e.includes("Auto")||("bing"!==e?t.wpSource&&(t.wpSource=void 0):t.wpSource=e,t.switchType="disabled",v())}),Object(p.c)(()=>{const{id:e}=t;e&&t.addRecentUsedP(e)});const e=document.querySelector(".wallpaper");Object(p.h)(()=>[t.urlInUI,t.color],async([i,o])=>{if(o&&"color"===t.type)Object(u.h)(o);else if(i){await Object(u.c)(i)?e.style.backgroundColor?(Object(u.h)("#999"),setTimeout(()=>{Object(u.i)(i)},200)):Object(u.i)(i):t.setDefaultWallpaperRaw()}})}(this),t.type){case"bing":this._setBingAfterInit();break;case"userLibraryAuto":this._checkLibraryExists()}e&&this.restartAutoBackupReaction()},this._syncLock=!1,this.mergeRemote=async(t,e)=>{try{if(this._syncLock)return;if(this._syncLock=!0,!("type"in t))return;if(m.n&&delete t.blur,"cloudRecentUsed"in t){if(e)this.setCloudRecentUsed(t.cloudRecentUsed);else{const e=Array.from(new Set(t.cloudRecentUsed.concat(this.cloudRecentUsed)));this.setCloudRecentUsed(e)}delete t.cloudRecentUsed}if("customColorItems"in t&&(this.mergeCustomColor(this.customColorItems,t.customColorItems,e?2:0),delete t.customColorItems),"local"===t.type)return void await this._mergeLocal(t);t.urlInUI=t.url,this._merge(t),this._afterSynced()}catch(t){console.log(t)}finally{this._syncLock=!1}},this.windmillRotating=!1,this._windmillPrevRotateSpeed=0,this._windmillPrevRotateDegree=0,this._windmillPrevRotateTime=-1,this.performWindmillRotate=t=>{if(-1===this._windmillPrevRotateTime)return this._windmillPrevRotateTime=t,void requestAnimationFrame(this.performWindmillRotate);const e=t-this._windmillPrevRotateTime;let i=this._windmillPrevRotateDegree;const{_windmillPrevRotateSpeed:o}=this;let s=o,n=0;if(this.windmillRotating)if(o<.46){let t,i;s+=36e-5*e,s>.46?(i=(s-.46)/36e-5,t=e-i,s=.46):(t=e,i=0),n=.46*i+o*t+18e-5*t*t}else n=.46*e;else{let i;s-=36e-5*e,s<0?(i=o/36e-5,s=0):i=e,0===s&&(t=-1),n=o*i-18e-5*i*i}i-=n,i%=360,i<0&&(i=360+i),this.windmillParent&&this.windmillParent.rotateWindMill(i),this._windmillPrevRotateDegree=i,this._windmillPrevRotateTime=t,this._windmillPrevRotateSpeed=s,0!==s&&requestAnimationFrame(this.performWindmillRotate)},this._lockLoadRandomP=!1,this.needSwitchWallpaper=!1,this._afterWpAutoSwitched=()=>{this._updateTimer(!0),this._prepareNextWp()},this.timeToSwitchWallpaper=async()=>{await this.switchWallpaper(),this._afterWpAutoSwitched()},this.switchToNextWallpaper=async()=>{try{await this.timeToSwitchWallpaper()}catch(t){g.message.top(i18n("wallpaper_switch_failure"))}},this._lockLoadUserWpNeeded=!1,this._lockRollback=!0,this.initAutoBackup("wallpaper",["id","url","rawUrl","wpSource","wpSourceName","type","switchType","color","timeEnd","index","opacity","blur","cloudRecentUsed","cloudRecentUsedOrder","customColorItems","nextPage","totalPage","wpExt"]),async function(t){await t.initSyncStore("store-wallpaper",["id","urlInUI","rawUrl","wpSource","wpSourceCount","wpSourceName","type","switchType","imageName","imageSource","imageType","color","index","timeEnd","remoteData","opacity","blur","cloudRecentUsed","localRecentUsed","cloudRecentUsedOrder","localRecentUsedOrder","nextPage","totalPage","wpExt","customColorItems","delay"],void 0,!0)}(this).then(this._whenLocalSynced).finally(()=>{setTimeout(()=>{this._lockRollback=!1},30)}),setTimeout(()=>{this.windmillParent=document.querySelector("newtab-main")})}_updateTimer(t=!1){const{switchType:e}=this;if(["disabled","when-newtab"].includes(e))v(),this.setTimeEnd(0);else{if(t){const t=Date.now();this.setTimeEnd(t+Object(w.b)(e))}!function(t,e){const i=Date.now(),o=Object(w.b)(e),s=t.timeEnd;let n;s>i?n=s-i:(n=o,t.setTimeEnd(i+o)),f.slave.postTask("slave:bg-run-timer-to-switch-wallpaper",n)}(this,e)}}setWpSourceName(t){this.wpSourceName=t}setWallpaper(t){this.setWallpaperRaw(t);const e={};e.type=this.type,e.switchType=this.switchType,e.nextP=null,e.ready=!1,e.oneP=!1,Object(u.j)(e)}async setBase64Wallpaper(){const{type:t,url:e}=this;if(["local","color"].includes(t))return;const i=await Object(w.f)(e);await Object(u.g)(i)}setWallpaperRaw(t){const{url:e,urlInUI:i,rawUrl:o,id:s,name:n,source:a}=t;n&&(this.imageName=n),this.id=s,this.url=e,this.urlInUI=i,this.rawUrl=o,this.imageSource=a,Object(u.j)({currentP:t}),this.setBase64Wallpaper()}setColor(t){this.type="color",this.id=t.id,this.color=t.content,this.urlInUI=void 0;const e={};e.type=this.type,e.color=t.content,e.switchType="disabled",Object(u.j)(e)}setCloudWallpaper(t){this.type="cloud",this.setCloudWallpaperRaw(t)}setCloudWallpaperRaw(t){this.setWallpaper({type:t.type,id:t.id,url:t.url,urlInUI:t.url,rawUrl:t.rawUrl,source:t.source})}setAutoWallpaperRaw(t){this.setWallpaperRaw({type:t.type,id:t.id,url:t.url,urlInUI:t.url,rawUrl:t.rawUrl,source:t.source})}setWpExt(t){this.wpExt=t}async setLocalWallpaper(t){const{file:e}=t;this.setWpExt(S.a.getExtension(e.type));const i=await Object(w.f)(e);await Object(u.g)(i),this.setType("local"),this.setWallpaper({type:t.type,url:null,urlInUI:t.url,rawUrl:t.url,id:t.id})}async enableBingWallpaper(t){this.type="bing",this.wpSource="bing",this.setBingWallpaper(t)}setBingWallpaper(t){this.setCloudWallpaperRaw(t)}setList(t){this.list=t}pushList(t){this.list.push(...t)}setIndex(t){this.index=t}setTimeEnd(t){this.timeEnd=t,Object(u.j)({timeEnd:this.timeEnd})}setRemoteData(t){this.remoteData=t}pushRemoteData(t){this.remoteData.push(...t)}spliceRemoteData(t,e=0){this.remoteData.splice(e,t)}get isAuto(){return this.type.includes("Auto")}removeLiked(t){const e=this.liked.indexOf(t);-1!==e&&this.liked.splice(e,1)}addLiked(t){const e=Object(p.j)(this.liked);e.push(t);const i=Array.from(new Set(e));this.setLiked(i)}includeLiked(t){return this.liked.includes(t)}async loadCollectionP(){const t=await Object(j.getCollectionWallpaper)();t.error||this.setCloudCollection(t.data)}async loadLikedP(){const t=await Object(j.getLikedWallpaper)();t.error||this.setLiked(t.data)}pushCustomColor(t){this.customColorItems.push(...t)}includesColorItem(t){return-1!==this.customColorItems.findIndex(({content:e})=>t===e)}appendCustomColor(t){if(-1===this.customColorItems.findIndex(({content:e})=>e===t.content)){const e=Object(p.j)(this.customColorItems);this.setCustomColorItems([t].concat(e))}}removeCustomColor(t){const e=this.customColorItems.findIndex(({id:e})=>e===t);-1!==e&&this.customColorItems.splice(e,1)}_rgbToHex(t){var e;return s()(e=t.map(t=>t.toString(16).padStart(0))).call(e,(t,e)=>t+e)}async addCustomColorItem(t){if(this.includesColorItem(t))return;const e=this._rgbaToHex(t),i=window.__INFINITY__.color_list,o=i.map(t=>k.a.hexColorDelta(e,t)),s=i[o.indexOf(Math.max.apply(null,o))],n={id:`${window.__INFINITY__.wpColorId}${Object(C.a)()}`,content:t,similarColor:s};try{_.userStore.isLogin&&await Object(j.addCustomColor)(n),this.appendCustomColor(Object.assign({type:"color"},n)),L.default.success(i18n("add_success"))}catch(t){L.default.error(i18n("network_error"))}}addCloudCollectionP(t){if(this.cloudCollection.includes(t))return;this.appendCloudCollection(t);const e=this._maxCollectionlen-this.collectionLen;if(e<0){const t=Object(p.j)(this.cloudCollection).reverse();t.length+=e,this.setCloudCollection(t.reverse())}}removeCloudCollectionP(t){const e=this.cloudCollection.indexOf(t);-1!==e&&this.cloudCollection.splice(e,1)}get collectionLen(){return this.cloudCollection.length}removeCollectionP(t){this.removeCloudCollectionP(t)}addCollectionP(t){this.addCloudCollectionP(t)}includeCollection(t){return this.cloudCollection.includes(t)}async loadCollectP(){const{cloudCollection:t,customColorItems:e}=this,{commonColorItems:i}=b.a,o=[];if(0!==t.length){const s=[],n=[],a=[];if(t.forEach(t=>{this.isLibraryItem(t)?n.push(t):this.isColorItem(t)?a.push(t):s.push(t)}),s.length>0){const t=await Object(j.getWallpapersById)(s.join(","));if(t.error)throw t.error;o.push(...Object(w.a)(t.data))}if(n.length>0){const t=await Object(j.getUserWallpaperLibraryItemsById)(n.join(","));if(t.error)throw t.error;o.push(...y.a.mapUploadWallpapers(t.items))}a.length>0&&a.forEach(t=>{let s=i.find(({id:e})=>e===t);s||(s=e.find(({id:e})=>e===t)),s&&o.push(s)})}return o}dropCloudRecentUsed(t){const e=this.cloudRecentUsed.indexOf(t);-1!==e&&this.cloudRecentUsed.splice(e,1)}get recentUsedLen(){return this.cloudRecentUsed.length+this.localRecentUsed.length}addLocalRecentP(t){if(this.setLocalRecentUsedOrder(t),this.localRecentUsed.includes(t))return;this.appendLocalRecentUsed(t);const e=this._maxRecentUsedLen-this.recentUsedLen;if(e<0){const t=Object(p.j)(this.localRecentUsed).reverse();t.length+=e,this.setLocalRecentUsed(t.reverse())}}addCloudRecentP(t){if(this.setCloudRecentUsedOrder(t),this.cloudRecentUsed.includes(t))return;this.appendCloudRecentUsed(t);const e=this._maxRecentUsedLen-this.recentUsedLen;if(e<0){const t=Object(p.j)(this.cloudRecentUsed).reverse();t.length+=e,this.setCloudRecentUsed(t.reverse())}}removeCloudRecentUsedP(t){const e=Object(p.j)(this.cloudRecentUsed);t.forEach(t=>{const i=e.indexOf(t);-1!==i&&e.splice(i,1)}),this.setCloudRecentUsed(e)}addRecentUsedP(t){this.addCloudRecentP(t)}_getItemTime(t){return"local"===t.type?this.localRecentUsedOrder[t.id]:["cloud","color"].includes(t.type)?this.cloudRecentUsedOrder[t.id]:void 0}async loadRecentUsedP(){const{localRecentUsed:t,cloudRecentUsed:e,customColorItems:i}=this,{localItems:o,commonColorItems:s}=b.a,n=[];if(0!==e.length){const t=[],o=[],a=[];if(e.forEach(e=>{this.isLibraryItem(e)?o.push(e):this.isColorItem(e)?a.push(e):t.push(e)}),t.length>0){const e=await Object(j.getWallpapersById)(t.join(","));if(e.error)throw e.error;n.push(...Object(w.a)(e.data))}if(o.length>0){const t=await Object(j.getUserWallpaperLibraryItemsById)(o.join(","));if(t.error)throw t.error;n.push(...y.a.mapUploadWallpapers(t.items))}a.length>0&&a.forEach(t=>{let e=s.find(({id:e})=>e===t);e||(e=i.find(({id:e})=>e===t)),e&&n.push(e)})}return a()(n).call(n,(t,e)=>{const i=this._getItemTime(t),o=this._getItemTime(e);return i>o?-1:i<o?1:0}),n}async getBackupData(){const t={};this.backupValueKeys.forEach(e=>{t[e]=Object(p.j)(this[e])});try{if("local"===this.type){const e=await Object(u.d)();t.url=e}else t.url=this.urlInUI}catch(e){t.type="default"}return t}async modifyUserLibrary(t){if(t!==this.wpSource)return;const e=y.a.customLibraryMap[t],i=e.findIndex(({_id:t})=>t===this.id),o=Object(u.e)(),{nextP:s}=o;(-1===e.findIndex(({_id:t})=>t===s.id)||e.length>1&&o.oneP)&&(o.nextP=null,o.ready=!1,o.oneP=!1,Object(u.j)(o)),-1===i&&await this.timeToSwitchWallpaper()}_setDefaultAfterInit(t){}_setLocalAfterInit({currentP:t}){this.rawUrl=this.urlInUI=t.rawUrl}_setCloudAutoAfterInit(t){t.ready?this._updateTimer(!0):(this.setAutoWallpaperRaw(t.currentP),this._afterWpAutoSwitched())}async _setBingAfterInit(){const t=await Object(w.c)();this.id!==t.id&&this.setCloudWallpaperRaw(t)}setDefaultWallpaperRaw(){this.id=null,this.urlInUI=this.url=u.b,this.rawUrl=u.a}setDefaultWallpaper(){this.id=null,this.type="default",this.urlInUI=this.url=u.b,this.rawUrl=u.a;const t=Object(u.e)();t.oneP=!1,t.ready=!1,t.currentP={id:null,url:u.b,urlInUI:u.b,rawUrl:u.a},t.type="default",t.switchType="disabled",Object(u.j)(t)}async _checkLibraryExists(){try{const t=await Object(j.hasWallpaperLibrary)(this.wpSource);if(t.error)throw t.error;1!==t.data&&this.setDefaultWallpaper()}catch(t){}}setType(t){this.type=t}_merge(t){Object.keys(t).forEach(e=>{this[e]!==t[e]&&(this[e]=t[e])})}async _mergeLocal(t){if("local"===this.type&&this.urlInUI.startsWith("blob:")){if(await Object(u.d)()!==t.url){const e=await O(t.url);t.urlInUI=t.rawUrl=c.a.createObjectURL(e),await Object(u.g)(t.url)}else t.urlInUI=null,t.rawUrl=null}else{const e=await O(t.url);t.urlInUI=t.rawUrl=c.a.createObjectURL(e),await Object(u.g)(t.url)}t.url=null;const e=t.wpExt;delete t.wpExt,this._merge(t),t.id?this.setWpExt(e):this.setWpExt(""),this._afterSynced()}async mergeCustomColor(t,e,i,o=!1){switch(i){case 1:if(0===t.length)return;await Object(j.setCustomColorItems)(t.map(t=>(delete t.type,t)));break;case 2:T.setCustomColorItems(e.map(t=>(t.type="color",t)));break;case 0:{const i=[],s=[];for(let e=0,o=t.length;e<o;++e){const o=t[e];s.includes(o.id)||(i.push(o),s.push(o.id))}for(let t=0,o=e.length;t<o;++t){const o=e[t];s.includes(o.id)||(i.push(o),s.push(o.id))}o&&await Object(j.setCustomColorItems)(i.map(t=>(delete t.type,t))),T.setCustomColorItems(i.map(t=>("type"in t||(t.type="color"),t)))}}}_afterSynced(){x.c&&Object(p.i)(()=>{this.url=this.url.replace(u.l,""),this.urlInUI=this.urlInUI.replace(u.l,"")});const t={currentP:{id:this.id,url:this.url,urlInUI:this.urlInUI,rawUrl:this.rawUrl}};t.type=this.type,t.color=this.color,t.switchType=this.switchType,t.timeEnd=this.timeEnd,t.opacity=this.opacity,t.blur=this.blur,t.ready=!1,t.oneP=!1,t.nextP=null,Object(u.j)(t),this.setBase64Wallpaper(),this.isAuto&&(this._updateTimer(),this._prepareNextWp())}startRotateWindmill(){this.windmillRotating=!0,0===this._windmillPrevRotateSpeed&&requestAnimationFrame(this.performWindmillRotate)}endRotateWindmill(){this.windmillRotating=!1}async randomWallpaper(){if(!this._lockLoadRandomP){this._lockLoadRandomP=!0,this.startRotateWindmill();try{const{data:t,error:e}=await Object(j.getRandomWallpaper)();if(e)throw new Error(JSON.stringify(e));const i=await Object(u.c)(t.url);if(!i)throw new Error("fetch res to check :"+i);this.setCloudWallpaper(Object.assign({type:"cloud"},t)),g.message.top(i18n("wallpaper_switch_success"))}catch(t){g.message.top(i18n("wallpaper_switch_failure"))}finally{this._lockLoadRandomP=!1,this.endRotateWindmill()}}}async getNextWp(...t){const{data:e}=await Object(j.getNextWallpaper)(...t),[i]=Object(w.a)([e]);return i}async _prepareNextWp(){if(Object(u.e)().oneP)return;const t="userLibraryAuto"!==this.type?"library":"userLibrary",e=await this.getNextWp(this.wpSource,this.id,t);await Object(u.c)(e.url);const i={};e.id===this.id?i.oneP=!0:i.oneP=!1,i.nextP=e,i.ready=!0,Object(u.j)(i)}enableUserLibraryAuto({libraryId:t,libraryName:e},i,o){this.type="userLibraryAuto",this.switchType=i,this.wpSource=t,this.wpSourceName=e,this._afterEnableWpAuto(o)}enableCloudAuto(t,e,i){this.type="cloudAuto",this.wpSource=t,this.switchType=e,this._afterEnableWpAuto(i)}_afterEnableWpAuto(t){this.setAutoWallpaperRaw(t);const e={currentP:t};e.type=this.type,e.switchType=this.switchType,e.timeEnd=this.timeEnd,e.ready=!1,e.oneP=!1,e.nextP=null,Object(u.j)(e),this._afterWpAutoSwitched()}async switchWallpaper(){Object(u.e)().ready||await this._prepareNextWp();const t=Object(u.e)();this.setAutoWallpaperRaw(t.nextP),Object(u.j)({ready:!1,nextP:null})}releaseLockLoadUserWp(){this._lockLoadUserWpNeeded=!1}lockLoadUserWp(){this._lockLoadUserWpNeeded=!0}loadUserWpNeededRaw(){const t=[];return this._lockLoadUserWpNeeded||t.push(y.a.loadUserWallpaperLibrary(),T.loadCollectionP(),T.loadLikedP()),d.a.all(t)}}R([p.g],P.prototype,"id",void 0),R([p.g],P.prototype,"url",void 0),R([p.g],P.prototype,"urlInUI",void 0),R([p.g],P.prototype,"rawUrl",void 0),R([p.g],P.prototype,"wpSource",void 0),R([p.g],P.prototype,"wpSourceCount",void 0),R([p.b],P.prototype,"setWpSouceCount",void 0),R([p.g],P.prototype,"type",void 0),R([p.g],P.prototype,"switchType",void 0),R([p.b],P.prototype,"setSwitchType",void 0),R([p.b],P.prototype,"setWpSourceCount",void 0),R([p.g],P.prototype,"wpSourceName",void 0),R([p.b],P.prototype,"setWpSourceName",null),R([p.g],P.prototype,"imageName",void 0),R([p.g],P.prototype,"imageSource",void 0),R([p.g],P.prototype,"imageType",void 0),R([p.b],P.prototype,"setWallpaper",null),R([p.b],P.prototype,"setWallpaperRaw",null),R([p.g],P.prototype,"color",void 0),R([p.b],P.prototype,"setColor",null),R([p.b],P.prototype,"setCloudWallpaper",null),R([p.b],P.prototype,"setCloudWallpaperRaw",null),R([p.b],P.prototype,"setAutoWallpaperRaw",null),R([p.g],P.prototype,"wpExt",void 0),R([p.b],P.prototype,"setWpExt",null),R([p.b],P.prototype,"enableBingWallpaper",null),R([p.b],P.prototype,"setBingWallpaper",null),R([p.g],P.prototype,"list",void 0),R([p.b],P.prototype,"setList",null),R([p.b],P.prototype,"pushList",null),R([p.g],P.prototype,"index",void 0),R([p.b],P.prototype,"setIndex",null),R([p.g],P.prototype,"timeEnd",void 0),R([p.b],P.prototype,"setTimeEnd",null),R([p.g],P.prototype,"remoteData",void 0),R([p.b],P.prototype,"setRemoteData",null),R([p.b],P.prototype,"pushRemoteData",null),R([p.b],P.prototype,"spliceRemoteData",null),R([p.g],P.prototype,"opacity",void 0),R([p.g],P.prototype,"blur",void 0),R([p.b],P.prototype,"setOpacity",void 0),R([p.b],P.prototype,"setBlur",void 0),R([p.e],P.prototype,"isAuto",null),R([p.g],P.prototype,"liked",void 0),R([p.b],P.prototype,"setLiked",void 0),R([p.b],P.prototype,"removeLiked",null),R([p.b],P.prototype,"addLiked",null),R([p.g],P.prototype,"customColorItems",void 0),R([p.b],P.prototype,"setCustomColorItems",void 0),R([p.b],P.prototype,"pushCustomColor",null),R([p.b],P.prototype,"removeCustomColor",null),R([p.b],P.prototype,"addCustomColorItem",null),R([p.g],P.prototype,"cloudCollection",void 0),R([p.b],P.prototype,"appendCloudCollection",void 0),R([p.b],P.prototype,"setCloudCollection",void 0),R([p.b],P.prototype,"addCloudCollectionP",null),R([p.b],P.prototype,"removeCloudCollectionP",null),R([p.e],P.prototype,"collectionLen",null),R([p.g],P.prototype,"cloudRecentUsed",void 0),R([p.b],P.prototype,"dropCloudRecentUsed",null),R([p.b],P.prototype,"setCloudRecentUsed",void 0),R([p.b],P.prototype,"appendCloudRecentUsed",void 0),R([p.g],P.prototype,"localRecentUsed",void 0),R([p.b],P.prototype,"setLocalRecentUsed",void 0),R([p.b],P.prototype,"appendLocalRecentUsed",void 0),R([p.e],P.prototype,"recentUsedLen",null),R([p.b],P.prototype,"addLocalRecentP",null),R([p.b],P.prototype,"addCloudRecentP",null),R([p.b],P.prototype,"removeCloudRecentUsedP",null),R([p.b],P.prototype,"modifyUserLibrary",null),R([p.g],P.prototype,"delay",void 0),R([p.b],P.prototype,"_setDefaultAfterInit",null),R([p.b],P.prototype,"_setLocalAfterInit",null),R([p.b],P.prototype,"_setCloudAutoAfterInit",null),R([p.b],P.prototype,"setDefaultWallpaperRaw",null),R([p.b],P.prototype,"setDefaultWallpaper",null),R([p.b],P.prototype,"setType",null),R([p.b],P.prototype,"_merge",null),R([p.b],P.prototype,"mergeRemote",void 0),R([p.b],P.prototype,"randomWallpaper",null),R([p.b],P.prototype,"enableUserLibraryAuto",null),R([p.b],P.prototype,"enableCloudAuto",null),R([p.b],P.prototype,"switchWallpaper",null);const T=new P;Object(p.h)(()=>T.wpSource,t=>y.a.setPSource(t),{fireImmediately:!0}),Object(p.h)(()=>_.userStore.isLogin,t=>{t||(T.setCloudCollection([]),T.setLiked([]),T.releaseLockLoadUserWp(),y.a.setCustomLibrary([]),y.a.clearCustomLibraryMap())})},470:function(t,e,i){"use strict";i.d(e,"b",(function(){return m})),i.d(e,"a",(function(){return b}));i(13),i(16),i(17),i(10),i(52);var o=i(8),s=i(363),n=i(21),a=i(129),r=i(338),c=i(375),l=i(0),d=i(472),p=i(497),u=i(345),h=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};class g extends s.a{constructor(){super(...arguments),this.localSettings={},this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.iconSpaceWidth=0,this.iconSpaceHeight=0,this.setting=this.init(),this.updatetime=0,this.permission={topUseful:-1,topBookmark:-1,searchSuggest:-1,gmailNotice:-1,gmailCount:-1,todoNotice:-1},this.logs=new Map,this.permissionMapper={topBookmark:[["bookmarks"],["chrome://favicon/"]],topUseful:[["topSites"],["chrome://favicon/"]],searchSuggest:[[],["https://suggestion.baidu.com/","https://google.com/"]],gmailNotice:[["notifications"],["https://mail.google.com/"]],gmailCount:[[],["https://mail.google.com/"]],todoNotice:[["notifications"],[]]},this.showSettingHomeModal=!1,this.webClickName=""}init(t={}){return{notice:Object.assign({},r.b.notice),link:Object.assign({},r.b.link),view:Object.assign({},r.b.view),layout:Object.assign({},r.b.layout),animation:Object.assign({},r.b.animation),icon:Object.assign({},r.b.icon),search:Object.assign({},r.b.search),font:Object.assign({},r.b.font),_v1Setting:t}}get withPermissionTopUseful(){return this.setting.view.topUseful&&1===this.permission.topUseful}get withPermissionTopBookmark(){return this.setting.view.topBookmark&&1===this.permission.topBookmark}get withPermissionSearchSuggest(){return this.setting.search.searchSuggest&&1===this.permission.searchSuggest}get needPermissionList(){const t=[],{view:e,notice:i,search:o}=this.setting,{topUseful:s,topBookmark:n,searchSuggest:a,gmailNotice:r,gmailCount:c,todoNotice:p}=this.permission;return l.m&&o.searchSuggest&&1!==a&&t.push({key:"searchSuggest",title:i18n("permission_serch_suggest_title"),content:i18n("permission_serch_suggest_content")}),l.m&&i.gmail&&1!==r&&t.push({key:"gmailNotice",title:i18n("permission_gmail_notice_title"),content:i18n("permission_gmail_notice_content")}),l.m&&i.gmailNumber&&1!==c&&t.push({key:"gmailCount",title:i18n("permission_gmail_num_title"),content:i18n("permission_gmail_num_content")}),!l.r&&e.topBookmark&&1!==n&&t.push({key:"topBookmark",title:i18n("permission_top_bookmark_title"),content:i18n("permission_top_bookmark_content")}),!l.r&&e.topUseful&&1!==s&&t.push({key:"topUseful",title:i18n("permission_top_useful_title"),content:i18n("permission_top_useful_content")}),d.a.needNotificationPermission&&1!==p&&(l.r&&"denied"===Notification.permission||t.push({key:"todoNotice",title:i18n("permission_todo_notice_title"),content:i18n("permission_todo_notice_content")})),t}get sideRatio(){return this.setting.view.scaleSide}reset(){this.setting=this.init(this.setting._v1Setting)}diffRemote(t){return!o.d.structural(t.setting||{},this.setting)}sendSettingValue(){Object.keys(this.localSettings).length&&(u.a.sendEvent({settingValue:this.localSettings}),this.localSettings={})}async mergeRemote(t){const e=t.setting;if(!t.setting)return;const i=this.setting;this.setting={notice:Object.assign(Object.assign({},i.notice),e.notice),link:Object.assign(Object.assign({},i.link),e.link),view:Object.assign(Object.assign({},i.view),e.view),layout:Object.assign(Object.assign({},i.layout),e.layout),animation:Object.assign(Object.assign({},i.animation),e.animation),icon:Object.assign(Object.assign({},i.icon),e.icon),search:Object.assign(Object.assign({},i.search),e.search),font:Object.assign(Object.assign({},i.font),e.font),_v1Setting:e._v1Setting};const s=await n.a.getTimestamp();Object(o.i)(()=>{this.updatetime=s})}sendSettingLog(t,e){this.logs.has(t)&&clearTimeout(this.logs.get(t)),this.logs.set(t,setTimeout(()=>{u.a.sendEvent({settingAction:{[t]:e}}),this.logs.delete(t)},2e3))}async changeSetting(t,e,i){if(this.setting[t][e]===i)return;this.setting[t][e]=i;let s=`${t}_${e}`,a=i;"layout"!==t||"col"!==e&&"row"!==e||(s="layout",a=this.setting.layout.row+"*"+this.setting.layout.col),this.sendSettingLog(s,a),this.localSettings[s]=a;const r=await n.a.getTimestamp();Object(o.i)(()=>{this.updatetime=r}),this.changeSettingEffect(t,e,i)}changeSettingEffect(t,e,i){switch(!0){case"topBookmark"===e:i&&this.requestPermission("topBookmark",!0);break;case"topUseful"===e:i&&this.requestPermission("topUseful",!0);break;case"notice"===t&&"gmail"===e:i&&this.requestPermission("gmailNotice",!0);break;case"notice"===t&&"gmailNumber"===e:i&&this.requestPermission("gmailCount",!0);break;case"searchSuggest"===e:i&&this.requestPermission("searchSuggest",!0)}}async checkPermission(t){if(l.r){switch(t){case"todoNotice":"granted"===Notification.permission?this.permission[t]=1:"default"===Notification.permission?this.permission[t]=-1:this.permission[t]=0}return}if(1===this.permission[t])return;const e=this.permissionMapper[t];try{await a.a.has(e[0],e[1])&&Object(o.i)(()=>{this.permission[t]=1})}catch(t){}}async requestPermission(t,e=!1){if(l.r&&["todoNotice"].includes(t))return await Object(p.a)(),void Object(o.i)(()=>{this.permission.todoNotice=1});const i=this.permissionMapper[t];if(e||0!==this.permission[t]&&1!==this.permission[t])try{await a.a.request(i[0],i[1]),Object(o.i)(()=>{this.permission[t]=1}),"gmailNotice"===t&&this.checkPermission("todoNotice")}catch(e){e&&"REJECT"===e.message&&Object(o.i)(()=>{this.permission[t]=0})}}async requestAllPermission(){if(l.r)return await Object(p.a)(),void Object(o.i)(()=>{this.permission.todoNotice=1});const t=[[],[]];this.needPermissionList.forEach(e=>{const i=this.permissionMapper[e.key];t[0].push(...i[0]),i&&t[1].push(...i[1])});try{await a.a.request(t[0],t[1]),Object(o.i)(()=>{this.needPermissionList.forEach(t=>{this.permission[t.key]=1})})}catch(t){Object(o.i)(()=>{this.needPermissionList.forEach(t=>{this.permission[t.key]=0})})}}resetPermission(t){this.permission[t]=-1}setIconSpace(t){this.setting.icon.scale=t.iconScale,this.setting.layout.colGap=t.colGap,this.setting.layout.rowGap=t.rowGap,this.setting.search.scale=t.searchScale}openSearchSuggest(){this.setting.search.searchSuggest?this.requestPermission("searchSuggest",!0):this.setting.search.searchSuggest=!0}get sideScaleRatio(){return this.setting.view.scaleSide}toggleShowSettingHome(t){this.setting.view.isShowHomepageBtn=!t}toggleSettingHomeModal(){this.webClickName="",this.showSettingHomeModal=!this.showSettingHomeModal}closeSettingHomeModal(){this.showSettingHomeModal=!1}setWebClickName(t){this.webClickName=t}}h([o.g],g.prototype,"innerWidth",void 0),h([o.g],g.prototype,"innerHeight",void 0),h([o.g],g.prototype,"iconSpaceWidth",void 0),h([o.g],g.prototype,"iconSpaceHeight",void 0),h([o.g],g.prototype,"setting",void 0),h([o.g],g.prototype,"updatetime",void 0),h([o.g],g.prototype,"permission",void 0),h([o.e],g.prototype,"withPermissionTopUseful",null),h([o.e],g.prototype,"withPermissionTopBookmark",null),h([o.e],g.prototype,"withPermissionSearchSuggest",null),h([o.e],g.prototype,"needPermissionList",null),h([o.e],g.prototype,"sideRatio",null),h([o.b],g.prototype,"reset",null),h([o.b],g.prototype,"mergeRemote",null),h([o.b],g.prototype,"changeSetting",null),h([o.b],g.prototype,"checkPermission",null),h([o.b],g.prototype,"requestPermission",null),h([o.b],g.prototype,"requestAllPermission",null),h([o.b],g.prototype,"resetPermission",null),h([o.b],g.prototype,"setIconSpace",null),h([o.b],g.prototype,"openSearchSuggest",null),h([o.e],g.prototype,"sideScaleRatio",null),h([o.b],g.prototype,"toggleShowSettingHome",null),h([o.g],g.prototype,"showSettingHomeModal",void 0),h([o.b],g.prototype,"toggleSettingHomeModal",null),h([o.b],g.prototype,"closeSettingHomeModal",null),h([o.g],g.prototype,"webClickName",void 0),h([o.b],g.prototype,"setWebClickName",null);const m=new g;m.initSyncStore("store-setting",["setting","permission","updatetime"],r.b),m.initAutoBackup("setting",["setting"]),Object(o.c)(()=>{m.firstSync&&m.setting.view.topBookmark&&m.checkPermission("topBookmark")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.view.topUseful&&m.checkPermission("topUseful")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.notice.gmail&&m.checkPermission("gmailNotice")},{delay:50}),Object(o.c)(()=>{d.a.firstSync&&d.a.needNotificationPermission&&m.checkPermission("todoNotice")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.notice.gmailNumber&&m.checkPermission("gmailCount")},{delay:50}),Object(o.c)(()=>{m.firstSync&&m.setting.search.searchSuggest&&m.checkPermission("searchSuggest")},{delay:50}),Object(o.c)(()=>{m.firstSync&&1===m.permission.gmailNotice&&n.a.send({key:"bg-notice-gmail-permission",data:!0})}),Object(o.c)(()=>{if(m.firstSync){const{gmail:t,gmailVoice:e,gmailNumber:i}=m.setting.notice,{gmailCount:o,gmailNotice:s}=m.permission;n.a.send({key:"bg-notice-gmail-updated",data:{gmail:t&&1===s,gmailVoice:e,gmailNumber:i&&(1===s||1===o)}})}},{delay:100}),Object(o.c)(()=>{if(!0===m.setting.layout.custom){const{customItem:t}=m.setting.layout;Object(o.i)(()=>{m.setting.layout.row=t[0],m.setting.layout.col=t[1]})}}),Object(o.c)(()=>{if(m.firstSync){const t={"--side-ratio":m.sideRatio,"--main-ratio":m.setting.view.scaleMain,"--icon-radius":Math.round(100*m.setting.icon.radius)+"%","--icon-font-color":m.setting.font.color,"--icon-font-size":Math.ceil(Math.max(m.setting.font.size*m.setting.view.scaleMain,12))+"px","--icon-opacity":m.setting.icon.opacity,"--icon-visible":m.setting.icon.isHideIconName?"hidden":"visible","--search-radius":""+m.setting.search.radius,"--search-opacity":m.setting.search.opacity};n.a.setStyle(t)}},{delay:50}),Object(o.c)(()=>{if(m.firstSync){let t=0,e=20;m.withPermissionTopBookmark&&(t+=36),m.withPermissionTopUseful&&(e+=26);const i={"--top-bar-height":t+"px","--settings-icon-top-offset":e+"px"};n.a.setStyle(i)}});const y=t=>{const e={"--search-height":t.searchHeight,"--search-width":t.searchWidth,"--search-margin-top":t.searchMarginTop,"--search-margin-bottom":t.searchMarginBottom,"--search-ratio":t.searchRatio,"--icon-box-width":t.iconBoxWidth,"--icon-box-height":t.iconBoxHeight,"--icon-one-height":t.iconOneHeight,"--icon-width":t.iconWidth,"--mini-icon-padding":t.miniIconPadding,"--icon-ratio":t.iconRatio,"--icon-row":m.setting.layout.row,"--icon-col":m.setting.layout.col,"--main-icons-margin":t.iconsMargin};n.a.setStyle(e)},b=(t=!0)=>{const e={row:m.setting.layout.row,col:m.setting.layout.col,rowGap:m.setting.layout.rowGap,colGap:m.setting.layout.colGap,iconScale:m.setting.icon.scale,searchScale:m.setting.search.scale,innerHeight:innerHeight,innerWidth:innerWidth,miniMode:m.setting.icon.miniMode,fontSize:m.setting.font.size,topUseful:m.withPermissionTopUseful,topBookmark:m.withPermissionTopBookmark,mainRatio:m.setting.view.scaleMain};if(t)requestIdleCallback(()=>{const t=Object(c.a)(e);y(t)});else{const t=Object(c.a)(e);y(t)}};Object(o.c)(()=>{m.firstSync&&b(!1)},{delay:40}),window.addEventListener("resize",n.a.throttle(()=>{b(!1)},56))},472:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var o=i(126),s=i.n(o),n=(i(13),i(16),i(10),i(8)),a=i(481),r=i.n(a),c=i(363),l=i(21),d=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};const p=[{text:i18n("todo_welcome"),todoId:"todo-id1dtkk87it2iepal6dv4hr2uig0c",time:Date.now(),updatetime:0,done:!1}];class u extends c.a{constructor(){super(...arguments),this.todoList=p,this.currenetState="done",this.listLength=localStorage.getItem("todo-length")||0}toggleState(t){this.currenetState=t}get needNotificationPermission(){return this.todoList.some(t=>!!t.dueDate)}diffRemote(t){const e=t=>{if(null==t?void 0:t.updatetime){const e={updatetime:void 0};return t.done=!!t.done,Object.assign(Object.assign({},t),e)}},i=r()(t.todoList||[],e),o=r()(Object(n.j)(this.todoList),e);return!n.d.structural(i,o)}mergeRemote(t,e){if(t.todoList)if(e)this.todoList=t.todoList;else{const e=this.todoList,i=t.todoList,{result:o}=l.a.mergeArray(e,i,"todoId");this.todoList=o}}edit(t){this.todoList=this.todoList.map(e=>e.todoId===t?Object.assign(Object.assign({},e),{edit:!e.edit}):e)}get hasDoneTodo(){return this.todoList.filter(t=>t.done).length}async addTodo(t){if(!s()(t).call(t).length)return;const e={done:!1,time:+new Date,todoId:l.a.randomId("todo-"),updatetime:await l.a.getTimestamp(),text:t};Object(n.i)(()=>{this.todoList=[e,...this.todoList]})}removeTodo(){this.todoList=this.todoList.filter(t=>!t.done)}deleteTodo(t){this.todoList=this.todoList.filter(e=>e.todoId!==t)}async toggleTodo(t){const e=await l.a.getTimestamp();Object(n.i)(()=>{this.todoList=this.todoList.map(i=>i.todoId===t?Object.assign(Object.assign({},i),{done:!i.done,updatetime:e}):Object.assign({},i))})}async updateTodo(t,e){const i=await l.a.getTimestamp();Object(n.i)(()=>{this.todoList=this.todoList.map(o=>o.todoId===t?Object.assign(Object.assign(Object.assign({},o),e),{updatetime:i,edit:!1}):Object.assign({},o))})}removeTime(t){this.todoList=this.todoList.map(e=>e.todoId===t?Object.assign(Object.assign({},e),{dueDate:"",dueTime:"",dueTimestamp:null}):e)}}d([n.g],u.prototype,"todoList",void 0),d([n.g],u.prototype,"currenetState",void 0),d([n.b],u.prototype,"toggleState",null),d([n.e],u.prototype,"needNotificationPermission",null),d([n.b],u.prototype,"mergeRemote",null),d([n.b],u.prototype,"edit",null),d([n.g],u.prototype,"listLength",void 0),d([n.e],u.prototype,"hasDoneTodo",null),d([n.b],u.prototype,"addTodo",null),d([n.b],u.prototype,"removeTodo",null),d([n.b],u.prototype,"deleteTodo",null),d([n.b],u.prototype,"toggleTodo",null),d([n.b],u.prototype,"updateTodo",null),d([n.b],u.prototype,"removeTime",null);const h=new u;h.initSyncStore("store-todo",["todoList","listLength"],{},!0),h.initAutoBackup("todo",["todoList"]),Object(n.c)(()=>{if(h.firstSync){const t=h.todoList.filter(t=>!t.done).length;Object(n.i)(()=>{h.listLength=t}),localStorage.setItem("todo-length",t+"")}}),Object(n.c)(()=>{let t=!1;const{todoList:e}=h;for(let i=0;i<e.length-1;i++){const{done:o}=e[i],s=e[i+1].done;if(o&&!s){t=!0;break}}t&&(Object(n.i)(()=>{const t=e.filter(t=>t.done),i=e.filter(t=>!t.done);h.todoList=[...i,...t]}),t=!1)},{delay:300})},473:function(t,e,i){"use strict";i.r(e),i.d(e,"weatherStore",(function(){return w})),i.d(e,"getCurrentWeather",(function(){return v}));var o=i(7),s=i.n(o),n=i(471),a=i.n(n),r=(i(13),i(16),i(10),i(8)),c=i(81),l=i(21),d=i(363),p=i(0);const u={100:i18n("w_100"),101:i18n("w_101"),102:i18n("w_102"),103:i18n("w_103"),104:i18n("w_104"),200:i18n("w_200"),201:i18n("w_201"),202:i18n("w_202"),203:i18n("w_203"),204:i18n("w_204"),205:i18n("w_205"),206:i18n("w_206"),207:i18n("w_207"),208:i18n("w_208"),209:i18n("w_209"),210:i18n("w_210"),211:i18n("w_211"),212:i18n("w_212"),213:i18n("w_213"),300:i18n("w_300"),301:i18n("w_301"),302:i18n("w_302"),303:i18n("w_303"),304:i18n("w_304"),305:i18n("w_305"),306:i18n("w_306"),307:i18n("w_307"),308:i18n("w_308"),309:i18n("w309"),310:i18n("w_310"),311:i18n("w_311"),312:i18n("w_312"),313:i18n("w_313"),314:i18n("w_314"),315:i18n("w_315"),316:i18n("w_316"),317:i18n("w_317"),318:i18n("w_318"),399:i18n("w_399"),400:i18n("w_400"),401:i18n("w_401"),402:i18n("w_402"),403:i18n("w_403"),404:i18n("w_404"),405:i18n("w_405"),406:i18n("w_406"),407:i18n("w_407"),408:i18n("w_408"),409:i18n("w_409"),410:i18n("w_410"),499:i18n("w_499"),500:i18n("w_500"),501:i18n("w_501"),502:i18n("w_502"),503:i18n("w_503"),504:i18n("w_504"),507:i18n("w_507"),508:i18n("w_508"),509:i18n("w_509"),510:i18n("w_510"),511:i18n("w_511"),512:i18n("w_512"),513:i18n("w_513"),514:i18n("w_514"),515:i18n("w_515"),900:i18n("w_900"),901:i18n("w_901"),999:i18n("w_999")},h={alyBGColor(t){let e="#36B3FF";switch(t.conditionCode){case"100":case"101":case"102":case"103":case"104":e="#0F7CFF";break;case"200":case"201":case"202":case"203":case"204":case"205":case"206":e="#10BDFF";break;case"207":case"208":case"209":case"210":case"211":case"212":e="#096BB2";break;case"213":case"900":e="#FF7F3B";break;case"300":case"301":case"302":case"303":case"304":case"305":case"306":case"307":case"308":case"309":case"310":case"311":case"312":case"313":case"314":case"315":case"316":case"317":case"318":case"399":e="#427BD1";break;case"301":case"300":case"402":case"403":case"404":case"405":case"406":case"407":case"408":case"409":case"410":case"4991":e="#87A6D5";break;case"500":case"501":case"502":case"503":case"504":case"505":case"506":case"507":case"508":case"509":case"510":case"511":case"512":case"513":case"514":case"515":case"999":e="#98A6BD";break;default:e="#0441C5"}return e},alyWIcon:t=>`${p.a}/weather/code_${t.conditionCode}.png`,alyText:t=>u[t.conditionCode]};function g(t,e,i){let o,s;return"celsius"===e?(o=t,s="C"):(o=Math.floor(1.8*t+32),s="F"),i&&(o+=s),o}var m=i(345),y=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},b=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(t);s<o.length;s++)e.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(t,o[s])&&(i[o[s]]=t[o[s]])}return i};class f extends d.a{constructor(){super(...arguments),this.localData={},this.list=[],this.lastUpdated=+new Date,this.unit="celsius",this.isShowModal=!1,this.isShowSetting=!1,this.searchState="none",this.citys=[]}get formateList(){return this.list.filter(t=>t.items).map(t=>{var e=b(t,[]);return e.items=e.items.map((t,e)=>{var i=b(t,[]);return 0===e&&(i._bgColor=h.alyBGColor(i),i._text=h.alyText(i)),i._bgImg=h.alyWIcon(i),i}),e})}sortList(t){this.list=t}changeIndex(t,e){var i;if(t===e)return;let o=[...this.list];const s=o.findIndex(e=>e.cid===t);if(-1===s)return;if("bottom"===e){const[t]=o.splice(s,1);o.push(t)}else if("top"===e){const[t]=o.splice(s,1);o.unshift(t)}else{const t=o.findIndex(t=>t.cid===e);if(-1===t)return;const[i]=o.splice(s,1);o.splice(t,0,i)}const n=(null===(i=this.list.filter(t=>t.top)[0])||void 0===i?void 0:i.name)||"";(n===t||n===e)&&(o=this.list.map(t=>t.top?Object.assign(Object.assign({},t),{top:0}):t)),this.list=o}openModal(){this.isShowModal=!0}closeModal(){this.isShowModal=!1,this.searchCitys("")}updateList(t){this.list=t}diffRemote(t){var e;if((null===(e=null==t?void 0:t.list)||void 0===e?void 0:e.length)!==this.list.length)return!0;if(this.unit!==t.unit)return!0;return this.list.some((e,i)=>e.cid!==t.list[i].cid)}async mergeRemote(t,e){if(t.list)try{const i=await this.getWeatherByCid(t.list);Object(r.i)(()=>{if(this.unit=t.unit,e)this.list=i;else{const t=this.list,e=i,{result:o}=l.a.mergeArray(t,e,"cid","updateTime");this.list=o}})}catch(t){}}async getWeatherByCid(t){t=t.filter(t=>t.name&&t.cid&&t.items);return await s.a.all(t.map(async t=>{if(t.cid){const e=await c.i.getForecastWeather(t.cid);if(null==e?void 0:e.data){return Object.assign(Object.assign({},e.data),{name:t.name})}}}))}async initLocal(){const t=await c.i.getLocalCity();Object(r.i)(()=>{t&&(this.localData=t.data)})}async addCity(t,e){const{data:i}=await c.i.getForecastWeather(t);if(!i)throw new Error(i18n("no_current_city_weather_data"));Object(r.i)(()=>{for(const e in this.list)if(this.list[e].cid===t)throw new Error(i18n("repeat_city"));this.list.push(Object.assign(Object.assign({},i),{cid:t,name:e})),this.lastUpdated=+new Date,this.closeModal()})}async searchCitys(t){if(!t)return this.citys=[],void(this.searchState="none");this.searchState="ing";try{const{data:e}=await c.i.getCityList(t);e?Object(r.i)(()=>{if(200===e.status){this.searchState="done";const t=e.cities.filter(t=>!this.filterCity(t.cid));this.citys=t}}):Object(r.i)(()=>{this.searchState="error"})}catch(t){Object(r.i)(()=>{this.searchState="error"})}}filterCity(t){const e=t.substr(t.length-1);return/^[a-zA-Z]+$/.test(e)}changeSelected(t,e){this.citys[t].selected=e}deleteCityWeather(t){let e=-1;for(const i in this.list)t===this.list[i].cid&&(e=Number(i));this.list.splice(e,1),this.lastUpdated=+new Date}changeUnit(){this.unit="celsius"===this.unit?"fahrenheit":"celsius",m.a.sendEvent({settingAction:{weatherUnit:this.unit}})}toggleSetting(){this.isShowSetting=!this.isShowSetting}closeSetting(){this.isShowSetting=!1}reset(){this.isShowSetting=!1,this.isShowModal=!1}toTop(t,e){var i;this.list=a()(i=this.list.map(i=>i.cid===t?Object.assign(Object.assign({},i),{top:0===e?1:0}):Object.assign(Object.assign({},i),{top:0}))).call(i,(t,e)=>e.top-t.top)}toggleOpen(t){this.list=this.list.map(e=>e.cid===t?Object.assign(Object.assign({},e),{open:0===e.open?1:0}):Object.assign({},e))}}y([r.g],f.prototype,"localData",void 0),y([r.g],f.prototype,"list",void 0),y([r.g],f.prototype,"lastUpdated",void 0),y([r.g],f.prototype,"unit",void 0),y([r.g],f.prototype,"isShowModal",void 0),y([r.g],f.prototype,"isShowSetting",void 0),y([r.g],f.prototype,"searchState",void 0),y([r.g],f.prototype,"citys",void 0),y([r.e],f.prototype,"formateList",null),y([r.b],f.prototype,"sortList",null),y([r.b],f.prototype,"changeIndex",null),y([r.b],f.prototype,"openModal",null),y([r.b],f.prototype,"closeModal",null),y([r.b],f.prototype,"updateList",null),y([r.b],f.prototype,"mergeRemote",null),y([r.b],f.prototype,"addCity",null),y([r.b],f.prototype,"searchCitys",null),y([r.b],f.prototype,"changeSelected",null),y([r.b],f.prototype,"deleteCityWeather",null),y([r.b],f.prototype,"changeUnit",null),y([r.b],f.prototype,"toggleSetting",null),y([r.b],f.prototype,"closeSetting",null),y([r.b],f.prototype,"reset",null),y([r.b],f.prototype,"toTop",null),y([r.b],f.prototype,"toggleOpen",null);const w=new f;w.initSyncStore("store-weather",["localData","list","unit","lastUpdated"],{},!0),w.initAutoBackup("weather",["list","unit"]);const v=()=>{const t=w.formateList[0],e=null==t?void 0:t.items[0];if(!e)return{};return{name:g(e.tmpMax,w.unit,!0),bgColor:e._bgColor,bgImg:e._bgImg}};Object(r.c)(()=>{w.list.some(t=>!t||!t.cid)&&(p.j&&alert("error"),Object(r.i)(()=>{w.list=w.list.filter(t=>(null==t?void 0:t.name)&&(null==t?void 0:t.cid)&&(null==t?void 0:t.items))}))})},475:function(t,e,i){"use strict";i.d(e,"a",(function(){return w}));var o=i(104),s=i.n(o),n=i(471),a=i.n(n),r=(i(13),i(16),i(52),i(10),i(8)),c=i(481),l=i.n(c),d=i(363),p=i(470),u=i(21),h=i(0),g=i(191),m=i(365),y=i(473),b=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};class f extends d.a{constructor(){super(...arguments),this.sites=Object(g.f)(h.B.lang),this.editingId=null,this.currentPageIndex=0,this.mergeSiteArray=(t,e,i)=>{const o=t=>{if("object"==typeof t){if(t.target===g.j.target){const e=["target","uuid"];return s()(e).call(e,(e,i)=>e+t[i],"")}{var e;const i=a()(e=Object.keys(t).filter(t=>"id"!==t&&"updatetime"!==t)).call(e);return s()(i).call(i,(e,i)=>e+t[i],"")}}},n=(t=>{const e=Object.create(null),i=t=>{t.forEach(t=>{var o;if(Array.isArray(t))i(t);else if(t&&t.id){const s=t.id;e[s]=t,(null===(o=t.children)||void 0===o?void 0:o.length)>0&&i(t.children)}})};return i(t),e})(e),r=(t=>{const e=Object.create(null),i=t=>{t.forEach(t=>{var s;if(Array.isArray(t))i(t);else if("object"==typeof t)if((null===(s=t.children)||void 0===s?void 0:s.length)>0)i(t.children);else{const i=o(t);e[i]=!0}})};return i(t),e})(e);let c=!1;t.forEach((e,i)=>{t[i]=e.filter(t=>{var e;const i=n[t.id],s=t.updatetime||0;if((null===(e=t.children)||void 0===e?void 0:e.length)>0){if(i){return s>(i.updatetime||0)&&(c=!0,i.name=t.name),t.children.forEach(t=>{if(n[t.id]){const e=n[t.id].updatetime||0;(t.updatetime||0)>e&&(c=!0,Object.assign(n[t.id],t))}else c=!0,i.children.push(t)}),!1}return t.children=t.children.filter(t=>{if(n[t.id]){const e=n[t.id].updatetime||0;return(t.updatetime||0)>e&&(c=!0,Object.assign(n[t.id],t)),!1}return!0}),0!==t.children.length&&(1===t.children.length&&(Object.assign(t,t.children[0]),delete t.children),!0)}{if(!t.updatetime)return!1;const e=o(t);if(r[e])return!1;if(i){return s>(i.updatetime||0)&&(c=!0,Object.assign(n[t.id],t)),!1}return!0}})});const l=[];if(t.forEach(t=>{t.forEach(t=>{l.push(t)})}),l.length>0&&e.length>0){c=!0;let t=e.length-1;l.forEach(o=>{e[t].length<i?e[t].push(o):(t+=1,e[t]=[o])})}return{result:e,isLocalEffective:c}},this.convertBackupEquals=t=>{const{sites:e}=t;return(null==e?void 0:e.length)&&e.forEach(t=>{(null==t?void 0:t.length)&&t.forEach(t=>{(null==t?void 0:t.uuid)===g.j.uuid?(t.name=void 0,t.bgColor=void 0,t.bgImage=void 0):(null==t?void 0:t.children)&&t.children.forEach(t=>{(null==t?void 0:t.uuid)===g.j.uuid&&(t.name=void 0,t.bgColor=void 0,t.bgImage=void 0)})})}),t}}get uids(){const t=new Set;return(m.pluginStore.pluginViews.includes("infinity://settings")||m.pluginStore.pluginViews.includes("profile"))&&this.sites.forEach(e=>{e.filter(t=>t).forEach(e=>{e.children?e.children.forEach(e=>{t.add(e.uuid+"#"+e.target)}):t.add(e.uuid+"#"+e.target)})}),t}changeCurrentPage(t){this.currentPageIndex=t}diffRemote(t){const e=t=>{if((null==t?void 0:t.target)===g.j.target){const e={name:void 0,bgColor:void 0,bgImage:void 0};return Object.assign(Object.assign({},t),e)}},i=l()(t.sites||[],e),o=l()(Object(r.j)(this.sites),e);return!r.d.structural(i,o)}mergeRemote(t,e){if(!t.sites)return;const i=Object(y.getCurrentWeather)();if(e)this.setWeatherIcon(t.sites,i),this.sites=t.sites;else{const{col:e,row:o}=p.b.setting.layout,s=e*o,{result:n}=this.mergeSiteArray(Object(r.j)(this.sites),t.sites,s);this.setWeatherIcon(n,i),this.sites=n}this.sites.length?this.sites.length-1<this.currentPageIndex&&document.querySelector("newtab-main").toPage(this.sites.length-1):this.currentPageIndex=0}clearEditSite(){this.editingId=null}setEditSite(t){this.editingId=t}delSites(t=[],e=!0){var i,o,s;const[n,a,r]=t;let c,l=null;return 2===t.length?c=this.sites[n].splice(a,1):3===t.length&&(c=null===(o=null===(i=this.sites[n][a])||void 0===i?void 0:i.children)||void 0===o?void 0:o.splice(r,1)),e&&this.finishingSites(t[0]),2===t.length&&0===(null===(s=this.sites[n])||void 0===s?void 0:s.length)&&(l=n),{data:c,clearPageIndex:l}}insertSite(t=[],e){var i,o;const[s,n,a]=t;2===t.length?this.sites[s].splice(n,0,e):3===t.length&&(null===(o=null===(i=this.sites[s][n])||void 0===i?void 0:i.children)||void 0===o||o.splice(a,0,e))}handelStatus(t,e,i,o,s){const[n]=t;let[a]=e;if(null!==s&&s<a&&(a-=1,document.querySelector("newtab-main")._toPrevPage(!0)),3===t.length&&i.children.length<2){const t=this.findIndex(n,i.id);this.destroyFolder(t),a-=1}const r=null!==s?Math.min(s,a):a;return this.finishingSites(Math.max(r,0)),this.findIndex(a,o.id)}findIndex(t,e){const i=[];for(let o=Math.max(t||0,0);o<this.sites.length;o++){const t=this.sites[o];i[0]=o;if(t.find((t,o)=>t.id===e?(i[1]=o,!0):!!t.children&&t.children.find((t,s)=>t.id===e&&(i[1]=o,i[2]=s,!0))))return i}}findIcon(t,e){let i={};for(let o=Math.max(t||0,0);o<this.sites.length;o++){if(this.sites[o].some(t=>t.id===e?(i=t,!0):!!t.children&&t.children.some(t=>t.id===e&&(i=t,!0))))return i}return i}destroyFolder(t){const[e,i]=t,o=this.sites[e][i].children;0===o.length?this.sites[e].splice(i,1):(this.sites[e][i]=o.shift(),o.length>0&&this.sites[e].push(...o))}manualDestroyFolder(t){const[e,i]=t,o=this.sites[e][i].children;this.sites[e].splice(i,1);const{col:s,row:n}=p.b.setting.layout,a=s*n-this.sites[e].length;if(a>=o.length)this.sites[e].push(...o);else{const t=o.splice(0,a);this.sites[e].push(...t);const i=this.sites.length-1;this.sites[i].push(...o),this.finishingSites(i)}}finishingSites(t=0){const{col:e,row:i}=p.b.setting.layout,o=e*i,s=t=>{if(this.sites.length<=t)return;const e=this.sites[t].length;if(e>o){const i=t+1,n=this.sites[t].splice(o,e-o);this.sites.length>i?this.sites[i].unshift(...n):this.sites.push(n),s(i)}else 0===e?(t&&t===this.sites.length-1&&document.querySelector("newtab-main").toPage(t-1),this.sites.splice(t,1),s(t)):s(t+1)};s(t);for(let t=0;t<this.sites.length;){const e=this.sites[t];e&&e.length||(this.sites.splice(t,1),t-=1),t+=1}}reSort(t,e){var i;const o=t*e,n=s()(i=this.sites).call(i,(t,e)=>t.concat(e),[]),a=Array(Math.ceil(n.length/o)).fill(null);this.sites=a.map((t,e)=>n.slice(e*o,(e+1)*o))}addSite(t,e=0){if(this.sites.length>e){const{col:i,row:o}=p.b.setting.layout,s=i*o;return this.sites[e].length<s?(this.sites[e].push(t),e):this.addSite(t,e+1)}return this.sites[e]=[t],e}isIcon(t,e){return!this.findIcon(t,e).children}changeFolderName(t,e){const[i,o]=t;this.sites[i][o].name=e,this.sites[i][o].updatetime=Date.now()}setWeatherIcon(t,e){t.forEach(t=>{t&&t.forEach(t=>{t.target===g.j.target&&(t.name=e.name||g.j.name,t.bgColor=e.bgColor||g.j.bgColor,t.bgImage=e.bgImg||g.j.bgImage),t.children&&t.children.forEach(t=>{t.target===g.j.target&&(t.name=e.name||g.j.name,t.bgColor=e.bgColor||g.j.bgColor,t.bgImage=e.bgImg||g.j.bgImage)})})})}async submitSite(t){if("color"===t.bgType?delete t.bgImage:"image"===t.bgType&&(delete t.bgFont,delete t.bgText,delete t.bgColorImage,"transparent"===t.bgColor&&(t.bgColor=void 0)),t.updatetime=await u.a.getTimestamp(),this.editingId){const e=this.findIcon(this.currentPageIndex,this.editingId);let i={};Object(r.i)(()=>{if(i=Object.assign(e,t),i.target===g.j.target){const t=Object(y.getCurrentWeather)();this.setWeatherIcon(w.sites,t)}})}else{const e=Object.assign({uuid:u.a.randomId("site-"),id:u.a.randomId("siteId-"),type:"web"},t),i=w.addSite(e,this.currentPageIndex);if(e.target===g.j.target){const t=Object(y.getCurrentWeather)();this.setWeatherIcon(w.sites,t)}document.querySelector("newtab-main").toPage(i)}return null}}b([r.g],f.prototype,"sites",void 0),b([r.g],f.prototype,"editingId",void 0),b([r.g],f.prototype,"currentPageIndex",void 0),b([r.e],f.prototype,"uids",null),b([r.b],f.prototype,"changeCurrentPage",null),b([r.b],f.prototype,"mergeRemote",null),b([r.b],f.prototype,"clearEditSite",null),b([r.b],f.prototype,"setEditSite",null),b([r.b],f.prototype,"delSites",null),b([r.b],f.prototype,"insertSite",null),b([r.b],f.prototype,"destroyFolder",null),b([r.b],f.prototype,"manualDestroyFolder",null),b([r.b],f.prototype,"finishingSites",null),b([r.b],f.prototype,"reSort",null),b([r.b],f.prototype,"addSite",null),b([r.b],f.prototype,"changeFolderName",null),b([r.b],f.prototype,"setWeatherIcon",null),b([r.b],f.prototype,"submitSite",null);const w=new f;w.initSyncStore("store-site",["sites"]),w.initAutoBackup("site",["sites"]),Object(r.h)(()=>[p.b.setting.layout.col,p.b.setting.layout.row].join(","),()=>{if(w.firstSync){const{col:t,row:e}=p.b.setting.layout;w.reSort(t,e),setTimeout(()=>{Object(p.a)(!1)},0)}});const v=()=>{requestIdleCallback(()=>{w.firstSync?w.sites.forEach((t,e)=>{t.forEach((t,i)=>{t||Object(r.i)(()=>{w.sites[e].splice(i,1)})})}):v()})};setTimeout(()=>{v()},60),Object(r.c)(()=>{if(y.weatherStore.firstSync){const t=Object(y.getCurrentWeather)();w.setWeatherIcon(w.sites,t)}},{delay:20})},476:function(t,e,i){"use strict";i.d(e,"a",(function(){return b}));var o=i(471),s=i.n(o),n=i(104),a=i.n(n),r=(i(13),i(16),i(52),i(10),i(8)),c=i(363),l=i(191),d=i(21),p=i(81),u=i(0),h=i(364),g=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};const m=u.B.isZh?l.a:l.b;class y extends c.a{constructor(){super(...arguments),this.list=[],this.defaultSearch=l.e,this.listHash="",this.version="",this.lang="",this.ignoreSuggest=!1,this.searchEngine={custom:[],addList:[],current:m,all:[Object.assign(Object.assign({},m),{updatetime:0}),Object.assign(Object.assign({},l.c),{updatetime:0})]},this.convertBackupEquals=t=>{var e,i;let o=null===(e=null==t?void 0:t.searchEngine)||void 0===e?void 0:e.all,s=null===(i=null==t?void 0:t.searchEngine)||void 0===i?void 0:i.current;if(o&&(o=t.searchEngine.all.map(t=>t.uuid)),s&&(s=t.searchEngine.current.uuid),o||s){const e=Object.assign(Object.assign({},t.searchEngine),{all:o,current:s});return Object.assign(Object.assign({},t),{searchEngine:e})}return t},this.mergeAddArray=(t=[],e=[])=>{const i="uuid";if(!t||0===t.length)return{result:e||[],isLocalEffective:!1};const o=e.filter(t=>!!t),n=t=>{if("object"==typeof t){var e;const i=s()(e=Object.keys(t).filter(t=>"uuid"!==t&&"updatetime"!==t)).call(e);return a()(i).call(i,(e,i)=>e+t[i],"")}},r=(t=>{const e=Object.create(null);return t.forEach(t=>{const i=n(t);e[i]=!0}),e})(e),c=Object.create(null);e.forEach((t,e)=>{if(t[i]){const o=t[i];c[o]=e}});let l=!1;return t.filter(t=>0!==t.updatetime).forEach(t=>{const e=n(t);if(r[e])return;const s=t[i],a=c[s];if(void 0!==a){(o[a].updatetime||0)<(t.updatetime||0)&&(o[a]=t,l=!0)}else l=!0,o.push(t)}),{result:o.filter(t=>!!t),isLocalEffective:l}}}get allItems(){return[this.defaultSearch,...this.searchEngine.all]}diffRemote(t){var e,i;const o=t.searchEngine||{};if(JSON.stringify(o.addList||{})!==JSON.stringify(this.searchEngine.addList))return!0;if(JSON.stringify(o.custom||{})!==JSON.stringify(this.searchEngine.custom))return!0;if((null===(e=o.current)||void 0===e?void 0:e.uuid)!==this.searchEngine.current.uuid)return!0;if((null===(i=o.all)||void 0===i?void 0:i.length)!==this.searchEngine.all.length)return!0;return this.searchEngine.all.some((t,e)=>{var i,s;return(null===(s=null===(i=o.all)||void 0===i?void 0:i[e])||void 0===s?void 0:s.uuid)!==t.uuid})}mergeRemote(t,e){if(t.searchEngine)if(e)this.searchEngine=this.transformSearchI18n(t.searchEngine);else{const e=this.searchEngine.custom,i=t.searchEngine.custom,{result:o}=d.a.mergeArray(e,i,"uuid"),s=this.searchEngine.addList,n=t.searchEngine.addList,{result:a}=this.mergeAddArray(s,n),r=this.searchEngine.all,c=t.searchEngine.all,{result:l}=d.a.mergeArray(r,c,"uuid");this.searchEngine=this.transformSearchI18n({custom:o,addList:a,current:t.searchEngine.current,all:l})}}transformSearchI18n(t){const e=Object.create(null);this.list.forEach(t=>{e[t.uuid]=t});const i=t=>e[t.uuid]?Object.assign(Object.assign({},t),e[t.uuid]):t;return{custom:t.custom,addList:t.addList,current:i(t.current),all:t.all.map(t=>i(t))}}setActive(t){this.searchEngine.current=this.allItems[t]}closeSuggestTips(){this.ignoreSuggest=!0}delShortcut(t){const e=this.searchEngine.all.findIndex(e=>e.uuid===t);e>-1&&this.searchEngine.all.splice(e,1)}updateShortcut(t){if(t){this.searchEngine.all.some((e,i)=>e.uuid===t.uuid&&(this.searchEngine.all[i]=t,!0))||this.searchEngine.all.push(t);const e=this.searchEngine.current.uuid;t.uuid===e&&(this.searchEngine.current=t)}}createEngine(t,e=null){if(null===e){const e=d.a.randomId("custom-search-"),i=Object.assign(Object.assign({},t),{uuid:e});return this.searchEngine.custom.push(i),i}return this.searchEngine.custom[e]=Object.assign(Object.assign({},this.searchEngine.custom[e]),t),this.searchEngine.custom[e]}delEngine(t){const{uuid:e}=this.searchEngine.custom[t];return e!==this.searchEngine.current.uuid&&(this.delShortcut(e),this.searchEngine.custom.splice(t,1),!0)}createEngineAdd(t,e=null){if(null===e){const e=d.a.randomId("add-search-"),i=Object.assign(Object.assign({},t),{uuid:e});return this.searchEngine.addList.push(Object.assign(Object.assign({},t),{uuid:e})),i}return this.searchEngine.addList[e]=Object.assign(Object.assign({},this.searchEngine.addList[e]),t),this.searchEngine.addList[e]}delEngineAdd(t){return this.searchEngine.addList.splice(t,1),!0}async getEnginesList(){let t=this.version;this.lang!==u.B.lang&&(t="");const{data:e,error:i}=await p.d.getEnginesList(t);if(!i&&(Object(r.i)(()=>{var t;this.version=null===(t=e.meta)||void 0===t?void 0:t.version,this.lang=u.B.lang}),e.hash!==this.listHash))if(h.userStore.isLogin)this.updateEngines({list:e.list,listHash:e.hash});else{this.stopAutoBackupReaction();try{this.updateEngines({list:e.list,listHash:e.hash})}catch(i){}this.restartAutoBackupReaction()}}updateEngines({list:t,listHash:e}){this.list=t,this.listHash=e;const i={};t.forEach(t=>{i[t.uuid]=t});const o=this.searchEngine.current.uuid;i[o]&&(this.searchEngine.current=i[o]);const s=this.defaultSearch.uuid;i[s]&&(this.defaultSearch=i[s]);const n=[];this.searchEngine.all.forEach(t=>{const e=t.uuid;i[e]?0===t.updatetime?n.push(Object.assign(Object.assign({},i[e]),{updatetime:0})):n.push(Object.assign({},i[e])):n.push(t)}),this.searchEngine.all=n}sortShortcut(t,e){if(t===e)return;const i=[...this.searchEngine.all],o=i.findIndex(e=>e.uuid===t);if(-1!==o){if("all"===e){const[t]=i.splice(o,1);i.push(t)}else{const t=i.findIndex(t=>t.uuid===e);if(-1===t)return;const[s]=i.splice(o,1);i.splice(t,0,s)}this.searchEngine.all=i}}}g([r.g],y.prototype,"list",void 0),g([r.g],y.prototype,"defaultSearch",void 0),g([r.g],y.prototype,"listHash",void 0),g([r.g],y.prototype,"version",void 0),g([r.g],y.prototype,"lang",void 0),g([r.g],y.prototype,"ignoreSuggest",void 0),g([r.g],y.prototype,"searchEngine",void 0),g([r.e],y.prototype,"allItems",null),g([r.b],y.prototype,"mergeRemote",null),g([r.b],y.prototype,"setActive",null),g([r.b],y.prototype,"closeSuggestTips",null),g([r.b],y.prototype,"delShortcut",null),g([r.b],y.prototype,"updateShortcut",null),g([r.b],y.prototype,"createEngine",null),g([r.b],y.prototype,"delEngine",null),g([r.b],y.prototype,"createEngineAdd",null),g([r.b],y.prototype,"delEngineAdd",null),g([r.b],y.prototype,"getEnginesList",null),g([r.b],y.prototype,"updateEngines",null),g([r.b],y.prototype,"sortShortcut",null);const b=new y;b.initSyncStore("store-search",["searchEngine","list","listHash","ignoreSuggest","version","lang"],{list:l.g}),b.initAutoBackup("searcher",["searchEngine"]),requestIdleCallback(()=>{b.getEnginesList()})},477:function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var o=i(471),s=i.n(o),n=(i(13),i(16),i(10),i(8)),a=i(481),r=i.n(a),c=i(363),l=i(81),d=i(21),p=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};const u=[{title:"",content:"",time:+new Date,id:"note-default-1ehj4oc7ubn8bgu9zb2spjip0vj",updatetime:0,fontSize:14}];class h extends c.a{constructor(){super(...arguments),this.linkModal=!1,this.list=u,this.checkedId=this.list[0].id,this.boldActive=!1}toogleLinkModal(){this.linkModal=!this.linkModal}setBoldActive(t){this.boldActive=t}get isEmpty(){return 0===this.list.length}get checkedNote(){return this.checkedId?this.list.filter(t=>t.id===this.checkedId)[0]:this.list[0]}get sortList(){var t,e;return(null===(t=this.list)||void 0===t?void 0:t.length)?s()(e=this.list.slice()).call(e,(t,e)=>e.time-t.time):[]}diffRemote(t){const e=t=>{if(null==t?void 0:t.updatetime){const e={updatetime:void 0};return Object.assign(Object.assign({},t),e)}},i=r()(t.list||[],e),o=r()(Object(n.j)(this.list),e);return!n.d.structural(i,o)}mergeRemote(t,e){if(t.list)if(e)this.list=t.list,this.checkedId=t.checkedId;else{const e=this.list,i=t.list;this.checkedId=t.checkedId;const{result:o}=d.a.mergeArray(e,i);this.list=o}}async add({title:t="",content:e=""}){const i=d.a.randomId("note-"),o=await d.a.getTimestamp(),s={title:t,content:e,time:+new Date,id:i,updatetime:o,fontSize:14};Object(n.i)(()=>{this.list=[s,...this.list],this.checkedId=i})}delete(t){this.list=this.list.filter(e=>e.id!==t),t!==this.checkedId||this.isEmpty||(this.checkedId=this.list[0].id)}updateId(t){this.checkedId=t}async updateNote(t){const e=await d.a.getTimestamp();Object(n.i)(()=>{var i;(null===(i=this.list)||void 0===i?void 0:i.length)&&(this.list=this.list.map(i=>i.id===t.id?Object.assign(Object.assign(Object.assign({},i),t),{updatetime:e}):Object.assign({},i)))})}async upload(t,e){var i,o;const{data:s,error:n}=await l.f.uploadFile(t,e+".png","infinity-notes-img");if(n){return{error:(null===(o=null===(i=n.response)||void 0===i?void 0:i.data)||void 0===o?void 0:o.error)?n.response.data.error:n.message,data:""}}return{data:s,error:""}}}p([n.g],h.prototype,"linkModal",void 0),p([n.b],h.prototype,"toogleLinkModal",null),p([n.g],h.prototype,"list",void 0),p([n.g],h.prototype,"checkedId",void 0),p([n.g],h.prototype,"boldActive",void 0),p([n.b],h.prototype,"setBoldActive",null),p([n.e],h.prototype,"isEmpty",null),p([n.e],h.prototype,"checkedNote",null),p([n.e],h.prototype,"sortList",null),p([n.b],h.prototype,"mergeRemote",null),p([n.b],h.prototype,"add",null),p([n.b],h.prototype,"delete",null),p([n.b],h.prototype,"updateId",null),p([n.b],h.prototype,"updateNote",null),p([n.b],h.prototype,"upload",null);const g=new h;g.initSyncStore("store-notes",["list","checkedId"],{},!0),g.initAutoBackup("note",["list","checkedId"])},479:function(t,e,i){"use strict";var o=i(48),s=i.n(o),n=(i(13),i(16),i(10),i(52),i(8)),a=i(81),r=i(344),c=i(498),l=i(26),d=i.n(l),p=i(21),u=i(337),h=i(480),g=i(188),m=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};class y{constructor(){this.cloudItems=[],this.setCloudItems=t=>this.cloudItems=t,this.appendCloudItems=t=>this.cloudItems.push(...t),this.recentItems=[],this.localItems=[],this.setLocalItems=t=>this.localItems=t,this.appendLocalItem=t=>{if(-1===this.localItems.findIndex(({id:e})=>e===t.id)){const e=Object(n.j)(this.localItems);this.setLocalItems([t].concat(e))}},this.collectItems=[],this.inLoading=!1,this.setInLoading=t=>this.inLoading=t,this.empty=!1,this.setEmpty=t=>this.empty=t,this.inLoadingNext=!1,this.setInLoadingNext=t=>this.inLoadingNext=t,this.error=!1,this.setError=t=>this.error=t,this.commonColorItems=[],this.filterCondition={},this._pageCount=0,this.mapToIcon={},this.removeFilterTag=()=>this.filterCondition.tag&&(this.filterCondition.tag=null),this.removeFilterColor=()=>this.filterCondition.color&&(this.filterCondition.color=null),this.localPObjectStore=d.a.createInstance({name:"idb-wallpaper",storeName:"store-local-wallpaper"}),this._loadLocalWallpapers()}setRecentItems(t){this.recentItems=t}async removeLocalItem(t){const e=this.localItems.findIndex(({id:e})=>e===t);-1!==e&&this.localItems.splice(e,1),await this.localPObjectStore.removeItem(t)}setCollectItems(t){this.collectItems=t}removeCollectItem(t){const e=this.collectItems.findIndex(({id:e})=>e===t);-1!==e&&this.collectItems.splice(e,1)}showItemExtraOpts(t){this.itemExtraOptsState===t?this.itemExtraOptsState=void 0:this.itemExtraOptsState=t}hideItemExtraOpts(){this.itemExtraOptsState=void 0}likeWp(t,e){const i=this.cloudItems.find(({id:e})=>e===t);i&&(1===e?i.like++:i.like>0&&i.like--)}initDataIfNeeded(){this.commonColorItems=[{id:window.__INFINITY__.wpColorId+"_1",type:"color",content:"#E1E1E1"},{id:window.__INFINITY__.wpColorId+"_2",type:"color",content:"#EE6D52"},{id:window.__INFINITY__.wpColorId+"_3",type:"color",content:"#FBAF42"},{id:window.__INFINITY__.wpColorId+"_4",type:"color",content:"#FFE000"},{id:window.__INFINITY__.wpColorId+"_5",type:"color",content:"#84D071"},{id:window.__INFINITY__.wpColorId+"_6",type:"color",content:"#6BC7DB"},{id:window.__INFINITY__.wpColorId+"_7",type:"color",content:"#4F9FED"},{id:window.__INFINITY__.wpColorId+"_8",type:"color",content:"#8D68E0"}],window.__INFINITY__.wallpaper_sources.forEach(t=>{this.mapToIcon[t.value]=t.icon})}async _loadLocalWallpapers(){const t=[];await this.localPObjectStore.iterate(e=>{const i=s.a.createObjectURL(e.file);if(e.rawUrl=e.url=i,e.smallFile){const t=s.a.createObjectURL(e.smallFile);e.content=t}else e.content=i;t.push(e)}),this.setLocalItems(t)}isFilterTag(t){return this.filterCondition.tag===t}setFilterTag(t){this.filterCondition.tag=t}isFilterColor(t){return this.filterCondition.color===t}setFilterColor(t){this.filterCondition.color=t}isFilterOrder(t){return this.filterCondition.order===t}setFilterOrder(t){this.filterCondition.order=t}clearState(){this.error&&this.setError(!1),this.empty&&this.setEmpty(!1),this.inLoading&&this.setInLoading(!1),this.inLoadingNext&&this.setInLoadingNext(!1)}async loadNextPage(){if(!(this.filterCondition.page>this._pageCount)){this.clearState(),this.setInLoadingNext(!0);try{const t=await this.loadWallpapersRaw(this.filterCondition);this.filterCondition.page=t.nextPage,this._pageCount=t.totalPages,this.appendCloudItems(t.data)}finally{this.setInLoadingNext(!1)}}}async loadCloudWallpapers(){const t=await this.loadWallpapersRaw(Object.assign(this.filterCondition,{page:0}));return this.filterCondition.page=t.nextPage,this._pageCount=t.totalPages,t.data}async loadWallpapersRaw(t){const{result:e,error:i}=await a.h.getWallpapers(t);if(i)throw i.__CANCEL__||(this.setError(!0),r.default.error(i.message),this.setInLoading(!1)),i;if(e.success)return e.data=Object(u.a)(e.data),e;throw r.default.error(i18n("unknown_mistake")),this.setError(!0),new Error(e)}async loadLocalImage(t){if(t.size>window.__INFINITY__.xMaxLocalFileSize)return void r.default.error(i18n("wallpaper_upload_file_size_exceed"));let e,i=t;try{Object(u.e)(t)&&(e=r.default.loading(i18n("wallpaper_loading")),await p.a.sleep(150),i=await Object(c.a)(t,{maxSizeMB:window.__INFINITY__.maxLocalFileSize/1024/1024,maxWidthOrHeight:window.__INFINITY__.minFileMaxWidthOrHeight,useWebWorker:!1}));const o=await this.addFileToLocal(i);return this.appendLocalItem(o),o}catch(t){throw r.default.error(i18n("wallpaper_apply_from_local_error")),t}finally{e&&e()}}async addFileToLocal(t){const e={type:"local",id:`${window.__INFINITY__.wpId}${Object(h.a)()}`,file:t};e.similarColor=await p.a.getSimilarColor(t);const i=await Object(c.a)(t,{useWebWorker:!0,maxWidthOrHeight:2*g.imgConfig.smallWidth});e.smallFile=i,await this.localPObjectStore.setItem(e.id,e);const o=s.a.createObjectURL(t),n=s.a.createObjectURL(i);return e.rawUrl=e.url=o,e.content=n,e}}m([n.g],y.prototype,"cloudItems",void 0),m([n.b],y.prototype,"setCloudItems",void 0),m([n.b],y.prototype,"appendCloudItems",void 0),m([n.g],y.prototype,"recentItems",void 0),m([n.b],y.prototype,"setRecentItems",null),m([n.g],y.prototype,"localItems",void 0),m([n.b],y.prototype,"setLocalItems",void 0),m([n.b],y.prototype,"removeLocalItem",null),m([n.g],y.prototype,"collectItems",void 0),m([n.b],y.prototype,"setCollectItems",null),m([n.b],y.prototype,"removeCollectItem",null),m([n.g],y.prototype,"itemExtraOptsState",void 0),m([n.b],y.prototype,"showItemExtraOpts",null),m([n.b],y.prototype,"hideItemExtraOpts",null),m([n.g],y.prototype,"inLoading",void 0),m([n.b],y.prototype,"setInLoading",void 0),m([n.g],y.prototype,"empty",void 0),m([n.b],y.prototype,"setEmpty",void 0),m([n.g],y.prototype,"inLoadingNext",void 0),m([n.b],y.prototype,"setInLoadingNext",void 0),m([n.g],y.prototype,"error",void 0),m([n.b],y.prototype,"setError",void 0),m([n.b],y.prototype,"likeWp",null),m([n.g],y.prototype,"commonColorItems",void 0),m([n.b],y.prototype,"initDataIfNeeded",null),m([n.g],y.prototype,"filterCondition",void 0),m([n.b],y.prototype,"setFilterTag",null),m([n.b],y.prototype,"setFilterColor",null),m([n.b],y.prototype,"setFilterOrder",null),m([n.b],y.prototype,"removeFilterTag",void 0),m([n.b],y.prototype,"removeFilterColor",void 0),m([n.b],y.prototype,"clearState",null);const b=new y;e.a=b},482:function(t,e,i){"use strict";var o=i(7),s=i.n(o),n=(i(10),i(13),i(16),i(21)),a=i(8),r=i(344),c=i(251),l=i(498),d=i(499),p=i.n(d),u=i(188),h=i(480),g=i(337),m=i(0),y=function(t,e,i,o){var s,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(n<3?s(a):n>3?s(e,i,a):s(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};class b{constructor(){this.setSwitchType=t=>this.switchTypeInUI=t,this.setPSource=t=>this.pSource=t,this.customLibraryMap={},this.customLibrary=[],this.setCustomLibrary=t=>this.customLibrary=t,this.maxCountPerLibrary=20,this.maxFileLenPerUpload=20,this._maxPerQueue=4,this._uploadKey="custom-wallpaper-library",this.switch_interval_options={"when-newtab":m.r?i18n("wallpaper_switch_when_open_web"):i18n("wallpaper_switch_when_open"),"per-hour":i18n("wallpaper_switch_per_hour"),"twelve-hour":i18n("wallpaper_switch_per_twelve_hour"),"one-day":i18n("wallpaper_switch_everyday")},this.iOptionsModalShow=!1,this.toggleIOptionsModal=t=>{t.stopPropagation(),this.iOptionsModalShow?this.iOptionsModalShow=!1:this.iOptionsModalShow=!0},this.mapUploadWallpapers=t=>t.map(t=>{const{content:e,url:i,rawUrl:o}=Object(u.convertURL)(t.url);return t.type="user-library",t.content=e,t.url=i,t.rawUrl=o,t})}setCustomLibraryMap(t,e){this.customLibraryMap[t]=e}delCustomLibraryMap(t){delete this.customLibraryMap[t]}clearCustomLibraryMap(){this.customLibraryMap={}}popCustomLibraryItem(t,e){const i=this.customLibraryMap[t],o=i.findIndex(({id:t})=>t===e);-1!==o&&i.splice(o,1)}appendCustomLibraryItem(t,e){const i=this.customLibraryMap[t];this.customLibraryMap[t]=i.concat(e)}getLibraryItems(t){return this.customLibraryMap[t]}getLibraryCoverImg(t){const e=this.customLibraryMap[t];return e&&e.length>0?e[0].content:null}popCustomLibrary(t){const e=this.customLibrary.findIndex(({libraryId:e})=>e===t);-1!==e&&this.customLibrary.splice(e,1)}appendCustomLibrary(t){this.customLibrary.push(t)}setCustomLibraryName(t,e){const i=this.customLibrary.findIndex(({libraryId:e})=>e===t);-1!==i&&(this.customLibrary[i].libraryName=e)}closeIOptionsModal(){this.iOptionsModalShow&&(this.iOptionsModalShow=!1)}async renameLibraryName(t,e){this.setCustomLibraryName(t,e),await Object(u.renameWallpaperLibrary)(t,e)}async removeWallpaperLibrary(t){const e=r.default.loading(i18n("wallpaper_loading"));try{await Object(u.removeWallpaperLibrary)(t),this.delCustomLibraryMap(t),this.popCustomLibrary(t)}finally{e()}}async loadUserWallpaperLibrary(){const t=(await Object(u.getUserWallpaperLibrary)()).data;this.setCustomLibrary(t),t.length>0&&await s.a.all(t.map(({libraryId:t})=>(async()=>{const e=await Object(u.getWallpaperLibraryItems)(t);this.setCustomLibraryMap(t,e.items)})()))}_filesPreCheck(t){return t.filter(t=>!(t.size>window.__INFINITY__.xMaxLocalFileSize))}async addImagesToLibrary(t,e){const i=this._filesPreCheck(e);if(0===i.length)return void r.default.error(i18n("wallpaper_upload_file_size_exceed"));i.length!==e.length&&r.default.error(i18n("wallpaper_upload_file_size_exceed"));const o=await this._uploadFileToCloudRaw(t,i);return await Object(u.addImagesToLibrary)(t,o),this.mapUploadWallpapers(o)}async createWallpaperLibrary(t){const e=this._filesPreCheck(t);if(0===e.length)return;const i=r.default.loading(i18n("wallpaper_loading"));try{const t=n.a.randomId(`${window.__INFINITY__.wpLibraryId}${Object(h.a)()}`),o=i18n("add_new_wallpaper_libary"),s=await this._uploadFileToCloudRaw(t,e),a=await Object(u.createWallpaperLibrary)({libraryName:o,libraryId:t,wallpapers:s});if(6001===a.code)return void r.default.error(a.message);const c=this.mapUploadWallpapers(s);this.appendCustomLibrary({libraryId:t,libraryName:o}),this.setCustomLibraryMap(t,c)}catch(t){throw r.default.error(i18n("wallpaper_create_library_error")),t}finally{i()}}async createWallpaperLibraryOnly(t,e){try{const i=await Object(u.createWallpaperLibrary)({libraryName:e,libraryId:t});if(6001===i.code)return void r.default.error(i.message);this.appendCustomLibrary({libraryId:t,libraryName:e}),this.setCustomLibraryMap(t,[])}catch(t){throw r.default.error(i18n("wallpaper_create_library_error")),t}}async _uploadFileToCloudRaw(t,e){const i=await this._handleLocalFiles(e),o=await this._uploadFileToCloud(i,t);return Array.apply(null,{length:o.length}).map((e,s)=>{const{id:n,similarColor:a}=i[s],{key:r,url:c}=o[s].data;return{id:n,key:r,url:c,libraryId:t,similarColor:a}})}_uploadFileToCloud(t,e){return s.a.all(t.map(({file:t,id:i})=>new s.a((o,s)=>{Object(c.uploadFile)(t,`${e}/${i}.${p.a.getExtension(t.type)}`,this._uploadKey).then(t=>{t.error?s(t):o(t)})})))}async _handleLocalFiles(t){const e=async t=>{let e=t;return Object(g.e)(t)&&(e=await Object(l.a)(t,{maxSizeMB:window.__INFINITY__.maxLocalFileSize/1024/1024,maxWidthOrHeight:window.__INFINITY__.minFileMaxWidthOrHeight,useWebWorker:!1})),{file:e,similarColor:await n.a.getSimilarColor(e)}},i=[];for(let o=0,n=t.length;o<n;o++)i.push(await e(t[o])),await new s.a(t=>setTimeout(t,100));return(t=>t.map(({file:t,similarColor:e})=>({id:n.a.randomId(`${window.__INFINITY__.wpLibraryItemId}${Object(h.a)()}`),file:t,similarColor:e})))(i)}}y([a.g],b.prototype,"switchTypeInUI",void 0),y([a.b],b.prototype,"setSwitchType",void 0),y([a.g],b.prototype,"pSource",void 0),y([a.b],b.prototype,"setPSource",void 0),y([a.g],b.prototype,"customLibraryMap",void 0),y([a.b],b.prototype,"setCustomLibraryMap",null),y([a.b],b.prototype,"delCustomLibraryMap",null),y([a.b],b.prototype,"clearCustomLibraryMap",null),y([a.b],b.prototype,"popCustomLibraryItem",null),y([a.b],b.prototype,"appendCustomLibraryItem",null),y([a.g],b.prototype,"customLibrary",void 0),y([a.b],b.prototype,"setCustomLibrary",void 0),y([a.b],b.prototype,"popCustomLibrary",null),y([a.b],b.prototype,"appendCustomLibrary",null),y([a.b],b.prototype,"setCustomLibraryName",null),y([a.g],b.prototype,"iOptionsModalShow",void 0),y([a.b],b.prototype,"closeIOptionsModal",null),y([a.b],b.prototype,"toggleIOptionsModal",void 0),y([a.b],b.prototype,"removeWallpaperLibrary",null);const f=new b;e.a=f},497:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i(7),s=i.n(o),n=(i(10),i(0)),a=i(129);async function r(){if(n.r){if("granted"!==await new s.a(t=>{!function(){try{Notification.requestPermission().then()}catch(t){return!1}return!0}()?Notification.requestPermission(t):Notification.requestPermission().then(t)}))throw new Error}else await a.a.request(["notifications"])}}}]);